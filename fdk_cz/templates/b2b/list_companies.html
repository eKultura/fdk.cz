{% extends "base.html" %}
{% block title %}B2B Firmy | FDK.cz{% endblock %}
{% block header_title %}üè¢ B2B Firmy{% endblock %}
{% block header_subtitle %}Seznam obchodn√≠ch partner≈Ø a firem{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Actions and Filters -->
  <div class="mb-6 flex flex-col md:flex-row justify-between gap-4">
    <div class="flex gap-3">
      <a href="{% url 'create_b2b_company' %}" class="btn btn-primary">+ Nov√° firma</a>
      <a href="{% url 'b2b_dashboard' %}" class="btn btn-outline">‚Üê Dashboard</a>
    </div>

    <!-- Filters -->
    <div class="flex gap-2">
      <!-- Category Filter -->
      <form method="GET" class="flex gap-2 items-center">
        {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
        <select name="category" onchange="this.form.submit()" class="form-control">
          <option value="">V≈°echny kategorie</option>
          {% for value, label in category_choices %}
            <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </form>

      <!-- Search -->
      <form method="GET" class="flex gap-2">
        {% if selected_category %}<input type="hidden" name="category" value="{{ selected_category }}">{% endif %}
        <input type="text" name="search" value="{{ search_query|default:'' }}" placeholder="Hledat firmu..." class="form-control">
        <button type="submit" class="btn btn-secondary">üîç</button>
      </form>
    </div>
  </div>

  <!-- Companies Table -->
  <div class="content-card">
    {% if companies %}
      <div class="overflow-x-auto">
        <table class="data-table">
          <thead>
            <tr>
              <th>N√°zev</th>
              <th class="hidden md:table-cell">Pr√°vn√≠ n√°zev</th>
              <th class="hidden md:table-cell">IƒåO</th>
              <th>Kategorie</th>
              <th class="hidden lg:table-cell">Smluv</th>
              <th class="text-right">Akce</th>
            </tr>
          </thead>
          <tbody>
            {% for company in companies %}
              <tr>
                <td>
                  <a href="{% url 'detail_b2b_company' company.company_id %}" class="font-semibold text-blue-600 hover:underline">
                    {{ company.name }}
                  </a>
                  {% if company.website %}
                    <div class="text-xs text-gray-500 mt-1">
                      <a href="{{ company.website }}" target="_blank" class="hover:underline">
                        üåê {{ company.website|slice:":30" }}
                      </a>
                    </div>
                  {% endif %}
                </td>
                <td class="hidden md:table-cell text-gray-600">
                  {{ company.legal_name|default:"‚Äî" }}
                </td>
                <td class="hidden md:table-cell text-gray-600">
                  {{ company.company_id_number|default:"‚Äî" }}
                </td>
                <td>
                  <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium">
                    {{ company.get_category_display }}
                  </span>
                </td>
                <td class="hidden lg:table-cell text-center">
                  <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-bold">
                    {{ company.contracts_count|default:0 }}
                  </span>
                </td>
                <td class="text-right">
                  <div class="data-table-actions">
                    <a href="{% url 'detail_b2b_company' company.company_id %}">üëÅÔ∏è Detail</a>
                    <a href="{% url 'edit_b2b_company' company.company_id %}">‚úèÔ∏è Upravit</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-12 bg-gray-50 rounded-lg">
        <div class="text-5xl mb-3">üè¢</div>
        <p class="text-gray-600 mb-4">
          {% if search_query or selected_category %}
            ≈Ω√°dn√© firmy odpov√≠daj√≠c√≠ va≈°emu hled√°n√≠
          {% else %}
            Zat√≠m nem√°te p≈ôidan√© ≈æ√°dn√© B2B firmy
          {% endif %}
        </p>
        {% if search_query or selected_category %}
          <a href="{% url 'list_b2b_companies' %}" class="btn btn-outline mr-2">Zru≈°it filtr</a>
        {% endif %}
        <a href="{% url 'create_b2b_company' %}" class="btn btn-primary">+ P≈ôidat prvn√≠ firmu</a>
      </div>
    {% endif %}
  </div>

  <!-- Info Card -->
  <div class="content-card mt-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200">
    <div class="flex items-start">
      <div class="text-3xl mr-4">üí°</div>
      <div>
        <h4 class="font-semibold text-gray-800 mb-2">Tipy pro spr√°vu B2B firem</h4>
        <ul class="text-sm text-gray-700 space-y-1">
          <li>‚Ä¢ Udr≈æujte aktu√°ln√≠ kontaktn√≠ √∫daje a pr√°vn√≠ informace</li>
          <li>‚Ä¢ Kategorizujte firmy podle typu spolupr√°ce (dodavatel, klient, partner)</li>
          <li>‚Ä¢ Propojte firmy se smlouvami pro lep≈°√≠ p≈ôehled</li>
          <li>‚Ä¢ Sledujte poƒçet aktivn√≠ch smluv s ka≈ædou firmou</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
