{% extends "base.html" %}
{% block title %}B2B Management | FDK.cz{% endblock %}
{% block header_title %}ü§ù B2B Management{% endblock %}
{% block header_subtitle %}Spr√°va B2B vztah≈Ø a obchodn√≠ch smluv{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <!-- Actions -->
  <div class="mb-10">
    <a href="{% url 'create_b2b_company' %}" class="btn btn-primary">+ Nov√° firma</a>
    <a href="{% url 'create_b2b_contract' %}" class="btn btn-secondary ml-2">+ Nov√° smlouva</a>
    <a href="{% url 'list_b2b_companies' %}" class="btn btn-outline ml-2">V≈°echny firmy</a>
    <a href="{% url 'list_b2b_contracts' %}" class="btn btn-outline ml-2">V≈°echny smlouvy</a>
  </div>

  <!-- Statistics -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="content-card">
      <h3 class="text-lg font-semibold mb-2">üìä Celkem firem</h3>
      <p class="text-3xl font-bold text-blue-600">{{ total_companies }}</p>
    </div>
    <div class="content-card">
      <h3 class="text-lg font-semibold mb-2">üìÑ Celkem smluv</h3>
      <p class="text-3xl font-bold text-green-600">{{ total_contracts }}</p>
    </div>
    <div class="content-card">
      <h3 class="text-lg font-semibold mb-2">‚úÖ Aktivn√≠ch smluv</h3>
      <p class="text-3xl font-bold text-purple-600">{{ active_contracts }}</p>
    </div>
  </div>

  <!-- Recent Companies -->
  <div class="content-card mb-6">
    <h3 class="text-xl font-semibold mb-4">Ned√°vno p≈ôidan√© firmy</h3>
    {% if companies %}
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">N√°zev</th>
            <th class="text-left py-2">Kategorie</th>
            <th class="text-left py-2">Kontakt</th>
            <th class="text-right py-2">Smlouvy</th>
            <th class="text-right py-2">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for company in companies %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-3">
              <a href="{% url 'detail_b2b_company' company.company_id %}" class="text-blue-600 hover:underline font-semibold">
                {{ company.name }}
              </a>
            </td>
            <td class="py-3">
              <span class="px-2 py-1 bg-gray-200 rounded text-sm">{{ company.get_category_display }}</span>
            </td>
            <td class="py-3">{{ company.email|default:"-" }}</td>
            <td class="py-3 text-right">{{ company.contracts_count }}</td>
            <td class="py-3 text-right">
              <a href="{% url 'detail_b2b_company' company.company_id %}" class="text-blue-600 hover:underline">Detail</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-8">Zat√≠m nejsou ≈æ√°dn√© B2B firmy. <a href="{% url 'create_b2b_company' %}" class="text-blue-600 hover:underline">Vytvo≈ôit prvn√≠ firmu</a></p>
    {% endif %}
  </div>

  <!-- Recent Contracts -->
  <div class="content-card">
    <h3 class="text-xl font-semibold mb-4">Ned√°vn√© smlouvy</h3>
    {% if recent_contracts %}
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">ƒå√≠slo smlouvy</th>
            <th class="text-left py-2">N√°zev</th>
            <th class="text-left py-2">Firma</th>
            <th class="text-left py-2">Status</th>
            <th class="text-right py-2">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for contract in recent_contracts %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-3">
              <a href="{% url 'detail_b2b_contract' contract.contract_id %}" class="text-blue-600 hover:underline font-semibold">
                {{ contract.contract_number }}
              </a>
            </td>
            <td class="py-3">{{ contract.title }}</td>
            <td class="py-3">{{ contract.company.name }}</td>
            <td class="py-3">
              <span class="px-2 py-1 bg-blue-200 rounded text-sm">{{ contract.get_status_display }}</span>
            </td>
            <td class="py-3 text-right">
              <a href="{% url 'detail_b2b_contract' contract.contract_id %}" class="text-blue-600 hover:underline">Detail</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-8">Zat√≠m nejsou ≈æ√°dn√© B2B smlouvy. <a href="{% url 'create_b2b_contract' %}" class="text-blue-600 hover:underline">Vytvo≈ôit prvn√≠ smlouvu</a></p>
    {% endif %}
  </div>
</div>
{% endblock %}