{% extends "base.html" %}
{% load i18n %}

{% block title %}P≈ôidat ƒçl√°nek | N√°povƒõda | FDK.cz{% endblock %}
{% block header_title %}Ôºã P≈ôidat nov√Ω ƒçl√°nek n√°povƒõdy{% endblock %}
{% block header_subtitle %}
Vytvo≈ôen√≠ nov√©ho ƒçl√°nku dokumentace pro u≈æivatele
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">

  <div class="content-card">
    <form method="POST">
      {% csrf_token %}

      <!-- Title -->
      <div class="form-group">
        <label for="title" class="form-label">N√°zev ƒçl√°nku <span class="required">*</span></label>
        <input type="text" name="title" id="title" class="form-control" required placeholder="Nap≈ô. √övod do spr√°vy projekt≈Ø">
      </div>

      <!-- Slug -->
      <div class="form-group">
        <label for="slug" class="form-label">URL slug</label>
        <input type="text" name="slug" id="slug" class="form-control" placeholder="uvod-do-spravy-projektu (nechte pr√°zdn√© pro automatick√© generov√°n√≠)">
        <div class="form-help">URL friendly verze n√°zvu. Pokud nech√°te pr√°zdn√©, vygeneruje se automaticky.</div>
      </div>

      <!-- Category -->
      <div class="form-group">
        <label for="category" class="form-label">Kategorie <span class="required">*</span></label>
        <select name="category" id="category" class="form-control" required>
          <option value="">-- Vyberte kategorii --</option>
          {% for value, label in categories %}
          <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Module (optional) -->
      <div class="form-group">
        <label for="module" class="form-label">Modul (voliteln√©)</label>
        <select name="module" id="module" class="form-control">
          <option value="">-- Bez modulu --</option>
          {% for module in modules %}
          <option value="{{ module.module_id }}">{{ module.display_name }}</option>
          {% endfor %}
        </select>
        <div class="form-help">Pokud se ƒçl√°nek vztahuje ke konkr√©tn√≠mu modulu, vyberte ho zde.</div>
      </div>

      <!-- Content -->
      <div class="form-group">
        <label for="content" class="form-label">Obsah (Markdown) <span class="required">*</span></label>
        <textarea name="content" id="content" rows="20" class="form-control" required placeholder="# Nadpis

Z√°kladn√≠ text ƒçl√°nku...

## Podnadpis

- Odr√°≈æka 1
- Odr√°≈æka 2

**Tuƒçn√Ω text** a *kurz√≠va*"></textarea>
        <div class="form-help">Podporuje Markdown form√°tov√°n√≠ (nadpisy, seznamy, tuƒçn√Ω text, odkazy atd.)</div>
      </div>

      <!-- Meta Description -->
      <div class="form-group">
        <label for="meta_description" class="form-label">Kr√°tk√Ω popis</label>
        <input type="text" name="meta_description" id="meta_description" class="form-control" maxlength="255" placeholder="Struƒçn√Ω popis pro zobrazen√≠ v seznamu">
      </div>

      <!-- Keywords -->
      <div class="form-group">
        <label for="keywords" class="form-label">Kl√≠ƒçov√° slova</label>
        <input type="text" name="keywords" id="keywords" class="form-control" placeholder="projekt, √∫kol, management, dokumentace">
        <div class="form-help">Oddƒõlen√© ƒç√°rkami pro lep≈°√≠ vyhled√°v√°n√≠</div>
      </div>

      <!-- Order -->
      <div class="form-group">
        <label for="order" class="form-label">Po≈ôad√≠ zobrazen√≠</label>
        <input type="number" name="order" id="order" class="form-control" value="0" min="0">
        <div class="form-help">Ni≈æ≈°√≠ ƒç√≠slo = vy≈°≈°√≠ pozice v seznamu</div>
      </div>

      <!-- Flags -->
      <div class="form-group">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="is_published" checked class="w-4 h-4">
          <span>Publikov√°no (viditeln√© pro u≈æivatele)</span>
        </label>
      </div>

      <div class="form-group">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="is_technical" class="w-4 h-4">
          <span>üîß Technick√° dokumentace (viditeln√© pouze pro administr√°tory a testery)</span>
        </label>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <a href="{% url 'help_index' %}" class="btn btn-outline">Zru≈°it</a>
        <button type="submit" class="btn btn-primary">üíæ Vytvo≈ôit ƒçl√°nek</button>
      </div>
    </form>
  </div>

</div>

<script>
// Auto-generate slug from title
document.getElementById('title').addEventListener('input', function() {
  const slugInput = document.getElementById('slug');
  if (!slugInput.value || slugInput.dataset.auto !== 'false') {
    const title = this.value;
    const slug = title
      .toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Remove diacritics
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '');
    slugInput.value = slug;
    slugInput.dataset.auto = 'true';
  }
});

document.getElementById('slug').addEventListener('input', function() {
  this.dataset.auto = 'false';
});
</script>
{% endblock %}
