{% extends "base.html" %}
{% block title %}IT Incidenty | FDK.cz{% endblock %}
{% block header_title %}ğŸš¨ IT Incidenty{% endblock %}
{% block header_subtitle %}PÅ™ehled IT incidentÅ¯ podle ITIL{% endblock %}

{% block context_breadcrumbs %}
  <a href="{% url 'it_dashboard' %}" class="breadcrumb-link">IT</a>
  <span class="breadcrumb-sep">â†’</span>
  <span style="font-weight: 600; color: #1e293b;">Incidenty</span>
{% endblock %}

{% block content %}

<div style="max-width: 1400px; margin: 0 auto;">
  <!-- Actions -->
  <div class="mb-10 flex gap-3">
    <a href="{% url 'create_it_incident' %}" class="btn btn-primary">+ NovÃ½ incident</a>
    <a href="{% url 'it_dashboard' %}" class="btn btn-outline">Dashboard</a>
    <a href="{% url 'list_it_assets' %}" class="btn btn-outline">IT Aktiva</a>
  </div>

  <div class="content-card">
    {% if incidents %}
      <div class="bg-white rounded-lg shadow-md overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÄŒÃ­slo incidentu</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NÃ¡zev</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organizace</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priorita</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NahlÃ¡sil</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NahlÃ¡Å¡eno</th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Akce</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for incident in incidents %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono font-bold text-gray-900">
                {{ incident.incident_number }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-900">{{ incident.title }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ incident.organization.name|default:"â€”" }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="px-3 py-1 rounded-full text-xs font-medium
                  {% if incident.priority == 'critical' %}bg-red-600 text-white
                  {% elif incident.priority == 'high' %}bg-orange-500 text-white
                  {% elif incident.priority == 'medium' %}bg-yellow-400 text-gray-900
                  {% else %}bg-blue-100 text-blue-700{% endif %}">
                  {{ incident.get_priority_display }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="px-3 py-1 rounded-full text-xs font-medium
                  {% if incident.status == 'closed' %}bg-gray-100 text-gray-700
                  {% elif incident.status == 'resolved' %}bg-green-100 text-green-700
                  {% elif incident.status == 'in_progress' %}bg-blue-100 text-blue-700
                  {% elif incident.status == 'assigned' %}bg-purple-100 text-purple-700
                  {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                  {{ incident.get_status_display }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if incident.reported_by %}
                  {{ incident.reported_by.get_full_name|default:incident.reported_by.username }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ incident.reported_at|date:"d.m.Y H:i" }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                <a href="{% url 'detail_it_incident' incident.incident_id %}" class="text-blue-600 hover:text-blue-900">Detail</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div style="text-align: center; padding: 3rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸš¨</div>
        <p style="color: #64748b;">ZatÃ­m nejsou Å¾Ã¡dnÃ© IT incidenty k zobrazenÃ­.</p>
        <a href="{% url 'create_it_incident' %}" class="btn btn-primary mt-4">+ VytvoÅ™it prvnÃ­ incident</a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
