{% extends "base.html" %}

{% block title %}
  {% if user.is_authenticated %}
    Dashboard | FDK.cz - Komplexní řízení organizací
  {% else %}
    FDK.cz - Komplexní řízení organizací
  {% endif %}
{% endblock %}

{% block header_title %}
  {% if user.is_authenticated %}
    Vítejte, {{ user.first_name|default:user.username }}!
  {% else %}
    FDK.cz - Komplexní řízení organizací
  {% endif %}
{% endblock %}

{% block header_subtitle %}
  {% if user.is_authenticated %}
    {% if user.companies.first %}
      {{ user.companies.first.name }} - IČO: {{ user.companies.first.ico }}
    {% else %}
      Dokončete nastavení své organizace pro plný přístup k funkcím
    {% endif %}
  {% else %}
    Moderní platforma pro efektivní správu organizací, projektů a AI právních nástrojů
  {% endif %}
{% endblock %}

{% block breadcrumb %}{% endblock %}

{% block content %}
<!-- AI Právo výstupy -->
        {% if user.is_authenticated and ai_outputs %}
        <div class="ai-outputs-section">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem;">
            <div style="font-size: 1.5rem;">&#9889;</div>
            <div>
              <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Nejnovější AI Právo výstupy</h2>
              <p style="color: #64748b; margin: 0;">Poslední analýzy a dokumenty z AI systému</p>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% for output in ai_outputs|slice:":3" %}
            <div class="ai-output-item">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem;">
                <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">{{ output.typ }}</span>
                <strong style="font-size: 0.9rem;">{{ output.nazev }}</strong>
              </div>
              <p style="font-size: 0.8rem; color: #64748b; margin: 0.5rem 0;">{{ output.popis|truncatewords:15 }}</p>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.75rem; color: #94a3b8;">{{ output.created_at|timesince }} zpět</div>
                <a href="" class="btn btn-outline" style="padding: 4px 8px; font-size: 0.75rem;">Zobrazit</a>
              </div>
            </div>
            {% endfor %}
          </div>
          
          <div style="margin-top: 1.5rem; text-align: center;">
            <a href="{% url 'pravo_ai' %}" class="btn btn-primary">
              Zobrazit všechny AI výstupy &#8594;
            </a>
          </div>
        </div>
        {% elif not user.is_authenticated %}
        <!-- Demo AI výstupy pro nepřihlášené uživatele -->
        <div class="ai-outputs-section">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem;">
            <div style="font-size: 1.5rem;">&#9889;</div>
            <div>
              <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0;">AI Právo - Ukázka možností</h2>
              <p style="color: #64748b; margin: 0;">Příklady analýz a dokumentů generovaných AI systémem</p>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            <div class="ai-output-item">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem;">
                <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Analýza smlouvy</span>
                <strong style="font-size: 0.9rem;">Kupní smlouva - rizikové klauzule</strong>
              </div>
              <p style="font-size: 0.8rem; color: #64748b; margin: 0.5rem 0;">AI identifikovalo 3 potenciální rizika a navrhlo 5 úprav pro lepší právní ochranu.</p>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.75rem; color: #94a3b8;">Před 15 minutami</div>
                <span style="background: #f1f5f9; color: #64748b; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Demo</span>
              </div>
            </div>
            
            <div class="ai-output-item">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem;">
                <span style="background: #059669; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Právní precedent</span>
                <strong style="font-size: 0.9rem;">Rozsudek NSS - správní řízení</strong>
              </div>
              <p style="font-size: 0.8rem; color: #64748b; margin: 0.5rem 0;">Nalezen relevantní rozsudek NSS 4 Ads 45/2023 vztahující se k problematice správního řízení.</p>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.75rem; color: #94a3b8;">Před 1 hodinou</div>
                <span style="background: #f1f5f9; color: #64748b; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Demo</span>
              </div>
            </div>
            
            <div class="ai-output-item">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem;">
                <span style="background: #dc2626; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Generování dokumentu</span>
                <strong style="font-size: 0.9rem;">Žaloba - vymáhání pohledávky</strong>
              </div>
              <p style="font-size: 0.8rem; color: #64748b; margin: 0.5rem 0;">Vygenerována žaloba dle § 142 OSŘ s automatickým výpočtem úroků a nákladů řízení.</p>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.75rem; color: #94a3b8;">Před 2 hodinami</div>
                <span style="background: #f1f5f9; color: #64748b; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">Demo</span>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 1.5rem; text-align: center;">
            <a href="{% url 'login_cs' %}" class="btn btn-primary">
              &#128273; Přihlásit se pro plný přístup k AI Právo &#8594;
            </a>
          </div>
        </div>
        {% endif %}

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
              <div>
                <div class="stat-title">Aktivní projekty</div>
                <div class="stat-value">
                  {% if user.is_authenticated %}
                    {{ total_projects|default:0 }}
                  {% else %}
                    1,247
                  {% endif %}
                </div>
                <div class="stat-change positive">
                  <span>&#8599;</span>
                  {% if user.is_authenticated %}
                    {{ completed_projects|default:0 }} dokončených
                  {% else %}
                    89 dokončených
                  {% endif %}
                </div>
              </div>
              <div class="stat-icon primary">&#128193;</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
              <div>
                <div class="stat-title">AI Dotazy</div>
                <div class="stat-value">
                  {% if user.is_authenticated %}
                    {{ ai_queries_count|default:0 }}
                  {% else %}
                    15,632
                  {% endif %}
                </div>
                <div class="stat-change positive">
                  <span>&#8599;</span>
                  {% if user.is_authenticated %}
                    {{ ai_queries_today|default:0 }} dnes
                  {% else %}
                    247 dnes
                  {% endif %}
                </div>
              </div>
              <div class="stat-icon info">&#9889;</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
              <div>
                <div class="stat-title">Organizace</div>
                <div class="stat-value">
                  {% if user.is_authenticated %}
                    {{ total_contacts|default:0 }}
                  {% else %}
                    3,456
                  {% endif %}
                </div>
                <div class="stat-change positive">
                  <span>&#8599;</span>
                  {% if user.is_authenticated %}
                    {{ new_contacts_month|default:0 }} nových
                  {% else %}
                    78 aktivních
                  {% endif %}
                </div>
              </div>
              <div class="stat-icon success">&#127970;</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
              <div>
                <div class="stat-title">Uživatelé</div>
                <div class="stat-value">
                  {% if user.is_authenticated %}
                    {{ pending_tasks|default:0 }}
                  {% else %}
                    892
                  {% endif %}
                </div>
                <div class="stat-change positive">
                  <span>&#8599;</span>
                  {% if user.is_authenticated %}
                    aktivních úkolů
                  {% else %}
                    registrovaných
                  {% endif %}
                </div>
              </div>
              <div class="stat-icon warning">&#128101;</div>
            </div>
          </div>
        </div>

        <!-- Content Grid - pouze pro přihlášené uživatele -->
        {% if user.is_authenticated %}
        <div class="content-grid">
          <!-- Projekty -->
          <div class="content-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h3>Moje projekty ({{ user_projects|length|default:0 }})</h3>
              <a href="{% url 'index_project_cs' %}" class="btn btn-primary">&#10133; Nový projekt</a>
            </div>
            
            {% if user_projects %}
            <ul class="item-list">
              {% for project in user_projects|slice:":5" %}
              <li class="item">
                <div class="item-header">
                  <a href="{% url 'detail_project' project.project_id %}" class="item-title">{{ project.name }}</a>
                  <span class="item-meta">{{ project.budget|default:'N/A' }}</span>
                </div>
                <div class="item-meta">{{ project.description|truncatewords:15 }}</div>
                <div class="progress-bar-container">
                  <div class="progress-bar" style="width: {{ project.progress|default:0 }}%"></div>
                </div>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <div class="empty-state">
              <div class="empty-state-icon">&#128193;</div>
              <p>Zatím nemáte žádné projekty</p>
              <a href="{% url 'index_project_cs' %}" class="btn btn-primary">Vytvořit první projekt</a>
            </div>
            {% endif %}
          </div>

          <!-- Úkoly -->
          <div class="content-card">
            <h3>Přiřazené úkoly ({{ user_tasks|length|default:0 }})</h3>
            
            {% if user_tasks %}
            <ul class="item-list">
              {% for task in user_tasks|slice:":5" %}
              <li class="item">
                <div class="item-header">
                  <a href="{% url 'detail_task' task.task_id %}" class="item-title">{{ task.title|safe }}</a>
                  <span class="item-meta {% if task.due_date|date:'Y-m-d' < today|date:'Y-m-d' %}negative{% endif %}">
                    {{ task.due_date|date:"d.m.Y" }}
                  </span>
                </div>
                <div class="item-meta">{{ task.description|truncatewords:10|safe }}</div>
              </li>
              {% endfor %}
            </ul>
            
            {% if user_tasks|length > 5 %}
            <div style="text-align: center; margin-top: 1rem;">
              <a href="{% url 'dashboard' %}" class="btn btn-outline">Zobrazit všechny úkoly</a>
            </div>
            {% endif %}
            
            {% else %}
            <div class="empty-state">
              <div class="empty-state-icon">&#128221;</div>
              <p>Nemáte žádné přiřazené úkoly</p>
            </div>
            {% endif %}
          </div>
        </div>
        {% else %}
        <!-- Call to action pro nepřihlášené uživatele -->
        <div style="background: white; border-radius: 12px; padding: 3rem; text-align: center; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">&#128640;</div>
          <h3 style="margin-bottom: 1rem; color: #1e293b;">Připojte se k FDK.cz</h3>
          <p style="color: #64748b; margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
            Získejte přístup k pokročilým AI nástrojům pro právní analýzy, komplexnímu projektovému managementu 
            a všem funkcím pro efektivní řízení vaší organizace.
          </p>
          <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <a href="{% url 'registration_cs' %}" class="btn btn-primary">
              &#128221; Zaregistrovat se
            </a>
            <a href="{% url 'login_cs' %}" class="btn btn-outline">
              &#128273; Přihlásit se
            </a>
          </div>
        </div>

        <!-- Features pro nepřihlášené uživatele -->
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">&#9889;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">AI Právní nástroje</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              Pokročilé AI pro analýzu smluv, hledání precedentů a generování právních dokumentů
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">&#128202;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">Projektový management</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              Komplexní řízení projektů s úkoly, deadliny a sledováním pokroku
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">&#128176;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">Účetnictví a finance</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              Správa financí, fakturace a kompletní účetní evidence
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">&#128101;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">Správa kontaktů</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              CRM systém pro správu klientů a obchodních partnerů
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">&#128196;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">Správa smluv</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              Sledování smluv, automatické upomínky a evidence dokumentů
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">&#128230;</div>
            <h4 style="margin-bottom: 1rem; color: #1e293b;">Skladové hospodářství</h4>
            <p style="color: #64748b; font-size: 0.9rem;">
              Kompletní správa skladových zásob a inventury
            </p>
          </div>
        </div>
        {% endif %}
{% endblock %}