{% extends "base.html" %}
{% block title %}SprÃ¡va pÅ™edplatnÃ½ch | FDK.cz{% endblock %}
{% block header_title %}ğŸ“‹ SprÃ¡va pÅ™edplatnÃ½ch{% endblock %}
{% block header_subtitle %}PÅ™ehled vÅ¡ech uÅ¾ivatelskÃ½ch pÅ™edplatnÃ½ch{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto;">

  <!-- Filter Buttons -->
  <div class="content-card" style="margin-bottom: 1.5rem;">
    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <span style="font-weight: 600; color: #1e293b;">Filtr:</span>
      <a href="{% url 'admin_subscriptions' %}"
         class="btn {% if not status_filter %}btn-primary{% else %}btn-outline{% endif %}">
        VÅ¡echna
      </a>
      <a href="{% url 'admin_subscriptions' %}?status=active"
         class="btn {% if status_filter == 'active' %}btn-primary{% else %}btn-outline{% endif %}">
        âœ… AktivnÃ­
      </a>
      <a href="{% url 'admin_subscriptions' %}?status=inactive"
         class="btn {% if status_filter == 'inactive' %}btn-primary{% else %}btn-outline{% endif %}">
        âŒ NeaktivnÃ­
      </a>
    </div>
  </div>

  <!-- Subscriptions Table -->
  <div class="content-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
      <h2 style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin: 0;">Seznam pÅ™edplatnÃ½ch</h2>
      <a href="{% url 'admin_assign_module' %}" class="btn btn-primary">
        â• PÅ™iÅ™adit modul
      </a>
    </div>

    {% if subscriptions %}
      <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
        <table class="data-table" style="min-width: 800px;">
          <thead>
            <tr>
              <th>UÅ¾ivatel</th>
              <th>Modul</th>
              <th>Typ</th>
              <th>ZpÅ¯sob platby</th>
              <th>ZaÄÃ¡tek</th>
              <th>Konec</th>
              <th style="text-align: center;">Stav</th>
            </tr>
          </thead>
          <tbody>
            {% for sub in subscriptions %}
              <tr>
                <td>
                  <div style="font-weight: 600; color: #1e293b;">{{ sub.user.username }}</div>
                  <div style="font-size: 0.875rem; color: #64748b;">{{ sub.user.email }}</div>
                </td>
                <td>
                  <div style="font-weight: 600; color: #1e293b;">{{ sub.module.display_name }}</div>
                  <div style="font-size: 0.75rem; color: #94a3b8;">{{ sub.module.name }}</div>
                </td>
                <td>
                  {% if sub.subscription_type == 'monthly' %}
                    ğŸ“… MÄ›sÃ­ÄnÃ­
                  {% elif sub.subscription_type == 'yearly' %}
                    ğŸ“† RoÄnÃ­
                  {% elif sub.subscription_type == 'lifetime' %}
                    â™¾ï¸ DoÅ¾ivotnÃ­
                  {% else %}
                    {{ sub.subscription_type }}
                  {% endif %}
                </td>
                <td>
                  {% if sub.payment_method == 'admin_assigned' %}
                    <span style="color: #7c3aed; font-weight: 500;">ğŸ‘¤ Admin pÅ™iÅ™azenÃ­</span>
                  {% elif sub.payment_method == 'card' %}
                    ğŸ’³ Karta
                  {% elif sub.payment_method == 'bank_transfer' %}
                    ğŸ¦ BankovnÃ­ pÅ™evod
                  {% else %}
                    {{ sub.payment_method|default:"N/A" }}
                  {% endif %}
                </td>
                <td>
                  <div>{{ sub.start_date|date:"d.m.Y" }}</div>
                  <div style="font-size: 0.75rem; color: #94a3b8;">{{ sub.start_date|date:"H:i" }}</div>
                </td>
                <td>
                  {% if sub.end_date %}
                    <div>{{ sub.end_date|date:"d.m.Y" }}</div>
                    <div style="font-size: 0.75rem; color: #94a3b8;">{{ sub.end_date|date:"H:i" }}</div>
                  {% else %}
                    <span style="color: #cbd5e1;">â€”</span>
                  {% endif %}
                </td>
                <td style="text-align: center;">
                  {% if sub.is_active %}
                    <span style="display: inline-block; padding: 0.25rem 0.75rem; background: #d1fae5; color: #065f46; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">âœ… AktivnÃ­</span>
                  {% else %}
                    <span style="display: inline-block; padding: 0.25rem 0.75rem; background: #fee2e2; color: #991b1b; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">âŒ NeaktivnÃ­</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div style="margin-top: 1rem; font-size: 0.875rem; color: #64748b;">
        Celkem: <strong style="color: #1e293b;">{{ subscriptions.count }}</strong> pÅ™edplatnÃ½ch
      </div>

    {% else %}
      <div style="text-align: center; padding: 4rem 2rem; color: #94a3b8;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“­</div>
        <p style="font-size: 1.125rem; margin-bottom: 0.5rem; color: #64748b;">Å½Ã¡dnÃ¡ pÅ™edplatnÃ¡ nenalezena</p>
        {% if status_filter %}
          <p style="font-size: 0.875rem;">Zkuste zmÄ›nit filtr nebo <a href="{% url 'admin_assign_module' %}" style="color: #3b82f6; text-decoration: none;">pÅ™iÅ™adit novÃ½ modul</a>.</p>
        {% else %}
          <p style="font-size: 0.875rem;">ZaÄnÄ›te <a href="{% url 'admin_assign_module' %}" style="color: #3b82f6; text-decoration: none;">pÅ™iÅ™azenÃ­m modulu uÅ¾ivateli</a>.</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- Back Link -->
  <div style="margin-top: 1.5rem;">
    <a href="{% url 'admin_modules' %}" class="btn btn-outline">â† ZpÄ›t na sprÃ¡vu modulÅ¯</a>
  </div>

</div>
{% endblock %}
