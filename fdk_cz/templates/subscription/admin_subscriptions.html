{% extends "base.html" %}
{% block title %}SprÃ¡va pÅ™edplatnÃ½ch | FDK.cz{% endblock %}
{% block header_title %}ğŸ“‹ SprÃ¡va pÅ™edplatnÃ½ch{% endblock %}
{% block header_subtitle %}PÅ™ehled vÅ¡ech uÅ¾ivatelskÃ½ch pÅ™edplatnÃ½ch{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">

  <!-- Filter Buttons -->
  <div class="content-card mb-6">
    <div class="flex gap-4 items-center">
      <span class="font-semibold">Filtr:</span>
      <a href="{% url 'admin_subscriptions' %}"
         class="btn {% if not status_filter %}btn-primary{% else %}btn-outline{% endif %}">
        VÅ¡echna
      </a>
      <a href="{% url 'admin_subscriptions' %}?status=active"
         class="btn {% if status_filter == 'active' %}btn-primary{% else %}btn-outline{% endif %}">
        âœ… AktivnÃ­
      </a>
      <a href="{% url 'admin_subscriptions' %}?status=inactive"
         class="btn {% if status_filter == 'inactive' %}btn-primary{% else %}btn-outline{% endif %}">
        âŒ NeaktivnÃ­
      </a>
    </div>
  </div>

  <!-- Subscriptions Table -->
  <div class="content-card">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Seznam pÅ™edplatnÃ½ch</h2>
      <a href="{% url 'admin_assign_module' %}" class="btn btn-primary">
        â• PÅ™iÅ™adit modul
      </a>
    </div>

    {% if subscriptions %}
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b">
              <th class="text-left p-3">UÅ¾ivatel</th>
              <th class="text-left p-3">Modul</th>
              <th class="text-left p-3">Typ</th>
              <th class="text-left p-3">ZpÅ¯sob platby</th>
              <th class="text-left p-3">ZaÄÃ¡tek</th>
              <th class="text-left p-3">Konec</th>
              <th class="text-left p-3">Stav</th>
            </tr>
          </thead>
          <tbody>
            {% for sub in subscriptions %}
              <tr class="border-b hover:bg-gray-50">
                <td class="p-3">
                  <div class="font-semibold">{{ sub.user.username }}</div>
                  <div class="text-sm text-gray-600">{{ sub.user.email }}</div>
                </td>
                <td class="p-3">
                  <div class="font-semibold">{{ sub.module.display_name }}</div>
                  <div class="text-xs text-gray-500">{{ sub.module.name }}</div>
                </td>
                <td class="p-3">
                  {% if sub.subscription_type == 'monthly' %}
                    ğŸ“… MÄ›sÃ­ÄnÃ­
                  {% elif sub.subscription_type == 'yearly' %}
                    ğŸ“† RoÄnÃ­
                  {% elif sub.subscription_type == 'lifetime' %}
                    â™¾ï¸ DoÅ¾ivotnÃ­
                  {% else %}
                    {{ sub.subscription_type }}
                  {% endif %}
                </td>
                <td class="p-3">
                  {% if sub.payment_method == 'admin_assigned' %}
                    <span class="text-purple-600">ğŸ‘¤ Admin pÅ™iÅ™azenÃ­</span>
                  {% elif sub.payment_method == 'card' %}
                    ğŸ’³ Karta
                  {% elif sub.payment_method == 'bank_transfer' %}
                    ğŸ¦ BankovnÃ­ pÅ™evod
                  {% else %}
                    {{ sub.payment_method|default:"N/A" }}
                  {% endif %}
                </td>
                <td class="p-3">
                  <div class="text-sm">{{ sub.start_date|date:"d.m.Y" }}</div>
                  <div class="text-xs text-gray-500">{{ sub.start_date|date:"H:i" }}</div>
                </td>
                <td class="p-3">
                  {% if sub.end_date %}
                    <div class="text-sm">{{ sub.end_date|date:"d.m.Y" }}</div>
                    <div class="text-xs text-gray-500">{{ sub.end_date|date:"H:i" }}</div>
                  {% else %}
                    <span class="text-gray-400">â€”</span>
                  {% endif %}
                </td>
                <td class="p-3">
                  {% if sub.is_active %}
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-sm">âœ… AktivnÃ­</span>
                  {% else %}
                    <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-sm">âŒ NeaktivnÃ­</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-4 text-sm text-gray-600">
        Celkem: <strong>{{ subscriptions.count }}</strong> pÅ™edplatnÃ½ch
      </div>

    {% else %}
      <div class="text-center py-12 text-gray-500">
        <p class="text-lg mb-2">ğŸ“­ Å½Ã¡dnÃ¡ pÅ™edplatnÃ¡ nenalezena</p>
        {% if status_filter %}
          <p class="text-sm">Zkuste zmÄ›nit filtr nebo <a href="{% url 'admin_assign_module' %}" class="text-blue-600 hover:underline">pÅ™iÅ™adit novÃ½ modul</a>.</p>
        {% else %}
          <p class="text-sm">ZaÄnÄ›te <a href="{% url 'admin_assign_module' %}" class="text-blue-600 hover:underline">pÅ™iÅ™azenÃ­m modulu uÅ¾ivateli</a>.</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- Back Link -->
  <div class="mt-6">
    <a href="{% url 'admin_modules' %}" class="btn btn-outline">â† ZpÄ›t na sprÃ¡vu modulÅ¯</a>
  </div>

</div>
{% endblock %}
