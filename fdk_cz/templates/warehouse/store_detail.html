{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ store.name }} | FDK.cz{% endblock %}
{% block header_title %}üì¶ {{ store.name }}{% endblock %}
{% block header_subtitle %}{% trans "Detail skladu a jeho specifikace" %}{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<div style="margin-bottom: 1.5rem; background: linear-gradient(to right, #eff6ff, #eef2ff); border: 2px solid #bfdbfe; border-radius: 8px; padding: 1rem;">
  <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; flex-wrap: wrap;">
    <span style="color: #64748b;">üìç Kontext:</span>
    {% if store.organization %}
    <a href="{% url 'organization_detail' store.organization.organization_id %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">{{ store.organization.name }}</a>
    {% elif store.project %}
    {% if store.project.organization %}
    <a href="{% url 'organization_detail' store.project.organization.organization_id %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">{{ store.project.organization.name }}</a>
    <span style="color: #9ca3af;">‚Üí</span>
    {% endif %}
    <a href="{% url 'detail_project' store.project.project_id %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">{{ store.project.name }}</a>
    {% else %}
    <span style="font-weight: 500; color: #1e293b;">Osobn√≠</span>
    {% endif %}
    <span style="color: #9ca3af;">‚Üí</span>
    <a href="{% url 'all_stores' %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">Sklad</a>
    <span style="color: #9ca3af;">‚Üí</span>
    <span style="font-weight: 600; color: #1e293b;">{{ store.name }}</span>
  </div>
</div>

<div style="max-width: 1000px; margin: 0 auto;">

  <!-- Actions -->
  <div style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem;">
    <a href="{% url 'create_warehouse_item' store.warehouse_id %}" class="btn btn-primary">+ {% trans "P≈ôidat polo≈æku" %}</a>
    <a href="{% url 'store_transactions' store.warehouse_id %}" class="btn btn-secondary">üìä {% trans "Transakce" %}</a>
    <a href="{% url 'all_stores' %}" class="btn btn-outline">‚Üê {% trans "Zpƒõt na sklady" %}</a>
  </div>

  <!-- Store Details -->
  <div class="content-card">
    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: #1e293b;">‚ÑπÔ∏è {% trans "Informace o skladu" %}</h3>

    <div style="display: grid; gap: 1.5rem;">
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "N√°zev skladu" %}</div>
        <div style="font-weight: 600; color: #1e293b; font-size: 1.125rem;">{{ store.name }}</div>
      </div>

      {% if store.description %}
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "Popis" %}</div>
        <div style="color: #1e293b; line-height: 1.6;">{{ store.description }}</div>
      </div>
      {% endif %}

      {% if store.location %}
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "Lokalita" %}</div>
        <div style="color: #1e293b;">üìç {{ store.location }}</div>
      </div>
      {% endif %}

      {% if store.capacity %}
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "Kapacita" %}</div>
        <div style="color: #1e293b; font-weight: 600;">{{ store.capacity }} {% trans "jednotek" %}</div>
      </div>
      {% endif %}

      {% if store.project %}
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "P≈ôi≈ôazeno k projektu" %}</div>
        <div style="color: #1e293b;">
          <a href="{% url 'detail_project' store.project.project_id %}" class="text-blue-600 hover:underline">
            üìÅ {{ store.project.name }}
          </a>
        </div>
      </div>
      {% endif %}

      {% if store.organization %}
      <div>
        <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 0.25rem;">{% trans "P≈ôi≈ôazeno k organizaci" %}</div>
        <div style="color: #1e293b;">
          <a href="{% url 'organization_detail' store.organization.organization_id %}" class="text-blue-600 hover:underline">
            üè¢ {{ store.organization.name }}
          </a>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Items in Warehouse -->
  <div class="content-card" style="margin-top: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h3 style="font-size: 1.25rem; font-weight: 600; color: #1e293b;">üì¶ {% trans "Polo≈æky ve skladu" %}</h3>
      <a href="{% url 'create_warehouse_item' store.warehouse_id %}" class="btn btn-primary btn-sm">+ {% trans "P≈ôidat polo≈æku" %}</a>
    </div>

    {% if store.items.all %}
    <form method="POST" action="{% url 'bulk_delete_warehouse_items' store.warehouse_id %}" id="bulk-delete-form">
      {% csrf_token %}

      <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
        <button type="submit" class="btn btn-outline" style="color: #dc2626; border-color: #dc2626;" onclick="return confirm('{% trans "Opravdu chcete smazat vybran√© polo≈æky?" %}')">
          üóëÔ∏è {% trans "Smazat vybran√©" %}
        </button>
        <span id="selected-count" style="color: #64748b; font-size: 0.875rem;"></span>
      </div>

      <div style="overflow-x: auto;">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width: 40px;">
                <input type="checkbox" id="select-all" class="w-4 h-4">
              </th>
              <th>{% trans "N√°zev" %}</th>
              <th class="hidden md:table-cell">{% trans "Kategorie" %}</th>
              <th class="text-center">{% trans "Mno≈æstv√≠" %}</th>
              <th class="hidden lg:table-cell">{% trans "Vytvo≈ôeno" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in store.items.all %}
            <tr>
              <td>
                <input type="checkbox" name="item_ids" value="{{ item.item_id }}" class="item-checkbox w-4 h-4">
              </td>
              <td>
                <a href="{% url 'item_detail' item.item_id %}" class="font-semibold text-blue-600 hover:underline">
                  {{ item.name }}
                </a>
                {% if item.description %}
                <div style="font-size: 0.875rem; color: #64748b; margin-top: 0.25rem;">{{ item.description|truncatewords:10 }}</div>
                {% endif %}
              </td>
              <td class="hidden md:table-cell text-gray-600">
                {% if item.category %}
                <span style="padding: 4px 12px; background: #eff6ff; color: #1e40af; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">
                  üè∑Ô∏è {{ item.category.name }}
                </span>
                {% else %}
                  ‚Äî
                {% endif %}
              </td>
              <td class="text-center">
                <span style="padding: 6px 16px; background: #dcfce7; color: #166534; border-radius: 12px; font-weight: 700; font-size: 1rem;">
                  {{ item.quantity }}
                </span>
              </td>
              <td class="hidden lg:table-cell" style="color: #64748b; font-size: 0.875rem;">
                {{ item.created|date:"d.m.Y H:i" }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </form>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
      const selectAllCheckbox = document.getElementById('select-all');
      const itemCheckboxes = document.querySelectorAll('.item-checkbox');
      const selectedCount = document.getElementById('selected-count');

      function updateSelectedCount() {
        const checkedCount = document.querySelectorAll('.item-checkbox:checked').length;
        if (checkedCount > 0) {
          selectedCount.textContent = `(${checkedCount} {% trans "vybr√°no" %})`;
        } else {
          selectedCount.textContent = '';
        }
      }

      selectAllCheckbox.addEventListener('change', (e) => {
        itemCheckboxes.forEach(checkbox => {
          checkbox.checked = e.target.checked;
        });
        updateSelectedCount();
      });

      itemCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          updateSelectedCount();
          const allChecked = Array.from(itemCheckboxes).every(cb => cb.checked);
          const someChecked = Array.from(itemCheckboxes).some(cb => cb.checked);
          selectAllCheckbox.checked = allChecked;
          selectAllCheckbox.indeterminate = someChecked && !allChecked;
        });
      });

      updateSelectedCount();
    });
    </script>
    {% else %}
    <div style="text-align: center; padding: 3rem; background: #f8fafc; border-radius: 8px;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
      <p style="color: #64748b; margin-bottom: 1rem;">{% trans "Ve skladu zat√≠m nejsou ≈æ√°dn√© polo≈æky" %}</p>
      <a href="{% url 'create_warehouse_item' store.warehouse_id %}" class="btn btn-primary">
        + {% trans "P≈ôidat prvn√≠ polo≈æku" %}
      </a>
    </div>
    {% endif %}
  </div>

</div>
{% endblock %}
