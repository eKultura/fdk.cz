{% extends "base.html" %}
{% block title %}ÃšÄetnictvÃ­ | FDK.cz{% endblock %}
{% block header_title %}ğŸ’° ÃšÄetnictvÃ­{% endblock %}
{% block header_subtitle %}SprÃ¡va faktur a penÄ›Å¾nÃ­ch denÃ­kÅ¯{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Navigation Cards -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem;">
    <a href="{% url 'create_invoice' %}" class="content-card hover:shadow-lg transition" style="text-decoration:none;cursor:pointer;">
      <div class="text-center p-4">
        <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“„</div>
        <h3 class="font-semibold text-gray-800">Faktury</h3>
        <p class="text-sm text-gray-600 mt-1">SprÃ¡va faktur</p>
      </div>
    </a>
    <a href="{% url 'journal_ledger' %}" class="content-card hover:shadow-lg transition" style="text-decoration:none;cursor:pointer;">
      <div class="text-center p-4">
        <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“š</div>
        <h3 class="font-semibold text-gray-800">ÃšÄetnÃ­ denÃ­k</h3>
        <p class="text-sm text-gray-600 mt-1">PodvojnÃ© ÃºÄetnictvÃ­</p>
      </div>
    </a>
    <a href="{% url 'balance_sheet_view' 'opening' %}" class="content-card hover:shadow-lg transition" style="text-decoration:none;cursor:pointer;">
      <div class="text-center p-4">
        <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“Š</div>
        <h3 class="font-semibold text-gray-800">Rozvaha</h3>
        <p class="text-sm text-gray-600 mt-1">PoÄÃ¡teÄnÃ­ / KoneÄnÃ¡</p>
      </div>
    </a>
    <a href="{% url 'chart_of_accounts' %}" class="content-card hover:shadow-lg transition" style="text-decoration:none;cursor:pointer;">
      <div class="text-center p-4">
        <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“‹</div>
        <h3 class="font-semibold text-gray-800">ÃšÄtovÃ¡ osnova</h3>
        <p class="text-sm text-gray-600 mt-1">SprÃ¡va ÃºÄtÅ¯</p>
      </div>
    </a>
  </div>

  <!-- Accounting Contexts (Organizace/OsobnÃ­) -->
  {% if accounting_contexts %}
  <div class="content-card mb-6">
    <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
      <h3 class="card-title" style="font-weight:600;font-size:1.1rem;">ğŸ¢ ÃšÄetnÃ­ kontexty</h3>
      <a href="{% url 'select_accounting_context' %}" class="btn btn-primary text-sm">&#10133; NovÃ½ kontext</a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for ctx in accounting_contexts %}
      <div class="p-4 border rounded-lg {% if current_context and ctx.context_id == current_context.context_id %}bg-blue-50 border-blue-300{% else %}bg-gray-50 border-gray-200 hover:border-blue-200 transition{% endif %}">
        <div class="flex justify-between items-start mb-2">
          <h4 class="font-semibold text-gray-800">{{ ctx.name }}</h4>
          {% if current_context and ctx.context_id == current_context.context_id %}
          <span class="px-2 py-1 bg-blue-600 text-white rounded text-xs">AktivnÃ­</span>
          {% endif %}
        </div>
        <p class="text-sm text-gray-600 mb-3">
          {% if ctx.organization %}ğŸ¢ {{ ctx.organization.name }}{% else %}ğŸ‘¤ OsobnÃ­{% endif %}
        </p>
        <p class="text-xs text-gray-500 mb-3">Rok: {{ ctx.fiscal_year }}</p>
        <div class="flex gap-2">
          {% if not current_context or ctx.context_id != current_context.context_id %}
          <a href="{% url 'set_accounting_context' ctx.context_id %}" class="btn btn-outline btn-sm">Aktivovat</a>
          {% endif %}
          <a href="{% url 'journal_ledger' %}" class="btn btn-outline btn-sm">DenÃ­k</a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Income Statement (VÃ½sledovka) -->
  <div class="content-card mb-6">
    <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
      <div>
        <h3 class="text-xl font-semibold text-gray-800">ğŸ“ˆ VÃ½sledovka â€“ BÄ›Å¾nÃ© obdobÃ­</h3>
        {% if current_context %}
        <p class="text-sm text-gray-600 mt-1">Kontext: {{ current_context.name }} ({{ current_context.fiscal_year }})</p>
        {% else %}
        <p class="text-sm text-gray-600 mt-1">Vyberte ÃºÄetnÃ­ kontext pro zobrazenÃ­ dat</p>
        {% endif %}
      </div>
      {% if current_context %}
      <a href="{% url 'balance_sheet_view' 'opening' %}" class="btn btn-outline text-sm">ğŸ“Š Rozvaha</a>
      {% endif %}
    </div>
    <div style="overflow-x:auto;margin-bottom:1.5rem;">
      <table style="width:100%;border-collapse:collapse;background:white;border:1px solid #e5e7eb;">
        <thead>
          <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb;">
            <th style="padding:1rem;text-align:left;font-weight:600;color:#4b5563;">PoloÅ¾ka</th>
            <th style="padding:1rem;text-align:right;font-weight:600;color:#4b5563;width:200px;">ÄŒÃ¡stka (KÄ)</th>
            <th style="padding:1rem;text-align:left;font-weight:600;color:#4b5563;width:120px;">ÃšÄty</th>
          </tr>
        </thead>
        <tbody>
          <!-- Revenues Section -->
          <tr style="background:#f0fdf4;border-bottom:1px solid #86efac;">
            <td style="padding:0.75rem 1rem;font-weight:600;color:#166534;">ğŸ’° VÃ½nosy celkem</td>
            <td style="padding:0.75rem 1rem;text-align:right;font-weight:700;color:#15803d;font-size:1.1rem;">{{ total_revenues|default:0|floatformat:2 }}</td>
            <td style="padding:0.75rem 1rem;font-size:0.875rem;color:#16a34a;">6xx</td>
          </tr>

          <!-- Expenses Section -->
          <tr style="background:#fef2f2;border-bottom:1px solid #fca5a5;">
            <td style="padding:0.75rem 1rem;font-weight:600;color:#991b1b;">ğŸ’¸ NÃ¡klady celkem</td>
            <td style="padding:0.75rem 1rem;text-align:right;font-weight:700;color:#dc2626;font-size:1.1rem;">{{ total_expenses|default:0|floatformat:2 }}</td>
            <td style="padding:0.75rem 1rem;font-size:0.875rem;color:#ef4444;">5xx</td>
          </tr>
        </tbody>
        <tfoot>
          <tr style="background:#f3f4f6;border-top:2px solid #d1d5db;">
            <td style="padding:1rem;font-weight:700;color:#1f2937;font-size:1.125rem;">
              {% if profit >= 0 %}
                ğŸ“Š HospodÃ¡Å™skÃ½ vÃ½sledek (ZISK)
              {% else %}
                ğŸ“‰ HospodÃ¡Å™skÃ½ vÃ½sledek (ZTRÃTA)
              {% endif %}
            </td>
            <td style="padding:1rem;text-align:right;font-weight:700;font-size:1.25rem;{% if profit >= 0 %}color:#1d4ed8;{% else %}color:#ea580c;{% endif %}">
              {{ profit|default:0|floatformat:2 }}
            </td>
            <td style="padding:1rem;font-size:0.875rem;{% if profit >= 0 %}color:#3b82f6;{% else %}color:#f97316;{% endif %}">
              VÃ½nosy - NÃ¡klady
            </td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Summary Cards - Quick Overview -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;">
      <div style="padding:1rem;background:#f0fdf4;border:1px solid #86efac;border-radius:8px;">
        <h4 style="font-size:0.875rem;font-weight:600;color:#166534;margin-bottom:0.5rem;">ğŸ’° VÃ½nosy</h4>
        <p style="font-size:1.5rem;font-weight:700;color:#15803d;">{{ total_revenues|default:0|floatformat:2 }} KÄ</p>
      </div>
      <div style="padding:1rem;background:#fef2f2;border:1px solid #fca5a5;border-radius:8px;">
        <h4 style="font-size:0.875rem;font-weight:600;color:#991b1b;margin-bottom:0.5rem;">ğŸ’¸ NÃ¡klady</h4>
        <p style="font-size:1.5rem;font-weight:700;color:#dc2626;">{{ total_expenses|default:0|floatformat:2 }} KÄ</p>
      </div>
      <div style="padding:1rem;{% if profit >= 0 %}background:#eff6ff;border:1px solid #93c5fd;{% else %}background:#fff7ed;border:1px solid #fdba74;{% endif %}border-radius:8px;">
        <h4 style="font-size:0.875rem;font-weight:600;{% if profit >= 0 %}color:#1e40af;{% else %}color:#9a3412;{% endif %}margin-bottom:0.5rem;">
          {% if profit >= 0 %}ğŸ“Š Zisk{% else %}ğŸ“‰ ZtrÃ¡ta{% endif %}
        </h4>
        <p style="font-size:1.5rem;font-weight:700;{% if profit >= 0 %}color:#1d4ed8;{% else %}color:#ea580c;{% endif %}">
          {{ profit|default:0|floatformat:2 }} KÄ
        </p>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-grid mb-6">
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">Celkem faktur</div>
          <div class="stat-value">{{ total_invoices|default:invoices|length|default:0 }}</div>
        </div>
        <div class="stat-icon primary">ğŸ“„</div>
      </div>
    </div>
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">NevyÅ™Ã­zenÃ½ch</div>
          <div class="stat-value">{{ pending_invoices|default:0 }}</div>
        </div>
        <div class="stat-icon warning">â³</div>
      </div>
    </div>
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">ZaplacenÃ½ch</div>
          <div class="stat-value">{{ paid_invoices|default:0 }}</div>
        </div>
        <div class="stat-icon success">âœ…</div>
      </div>
    </div>
  </div>

  <!-- Recent Invoices -->
  <div class="content-card">
    <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
      <h3 class="card-title" style="font-weight:600;font-size:1.1rem;">ğŸ“„ NedÃ¡vnÃ© faktury</h3>
      <div class="flex gap-2">
        <a href="{% url 'create_invoice' %}" class="btn btn-primary text-sm">&#10133; NovÃ¡ faktura</a>
        <a href="{% url 'list_invoices' %}" class="btn btn-outline text-sm">VÅ¡echny faktury</a>
      </div>
    </div>
    {% if invoices %}
    <div class="overflow-x-auto">
      <table class="data-table" style="width:100%;border-collapse:collapse;">
        <thead style="background:#f9fafb;">
          <tr>
            <th class="px-4 py-2 text-left text-gray-600 font-semibold">ÄŒÃ­slo faktury</th>
            <th class="px-4 py-2 text-left text-gray-600 font-semibold hidden md:table-cell">Datum vystavenÃ­</th>
            <th class="px-4 py-2 text-left text-gray-600 font-semibold hidden md:table-cell">Datum splatnosti</th>
            <th class="px-4 py-2 text-left text-gray-600 font-semibold hidden lg:table-cell">PlÃ¡tce</th>
            <th class="px-4 py-2 text-right text-gray-600 font-semibold">ÄŒÃ¡stka</th>
            <th class="px-4 py-2 text-left text-gray-600 font-semibold">Stav</th>
            <th class="px-4 py-2 text-center text-gray-600 font-semibold w-1/6">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for invoice in invoices %}
          <tr style="border-bottom:1px solid #e5e7eb;" class="hover:bg-gray-50 transition">
            <td class="px-4 py-2 text-gray-800 font-medium">{{ invoice.invoice_number }}</td>
            <td class="px-4 py-2 text-gray-500 hidden md:table-cell">{{ invoice.issue_date|date:"d.m.Y"|default:"â€“" }}</td>
            <td class="px-4 py-2 text-gray-500 hidden md:table-cell">{{ invoice.due_date|date:"d.m.Y"|default:"â€“" }}</td>
            <td class="px-4 py-2 text-gray-500 hidden lg:table-cell">{{ invoice.company.name|default:"â€“" }}</td>
            <td class="px-4 py-2 text-right font-semibold text-gray-800">{{ invoice.total_amount|default:"â€“" }} KÄ</td>
            <td class="px-4 py-2">
              {% if invoice.status == 'paid' %}
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-sm">âœ“ Zaplaceno</span>
              {% elif invoice.status == 'pending' %}
                <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-sm">â³ ÄŒekÃ¡</span>
              {% elif invoice.status == 'overdue' %}
                <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-sm">âš ï¸ Po splatnosti</span>
              {% else %}
                <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm">{{ invoice.get_status_display }}</span>
              {% endif %}
            </td>
            <td class="px-4 py-2 text-center">
              <a href="{% url 'detail_invoice' invoice.id %}" class="text-blue-600 hover:text-blue-800 text-sm mr-2">Detail</a>
              <a href="{% url 'edit_invoice' invoice.id %}" class="text-yellow-600 hover:text-yellow-800 text-sm">Upravit</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state" style="text-align:center;padding:2rem;color:#6b7280;">
      <div style="font-size:2rem;">ğŸ“„</div>
      <p style="margin-top:0.5rem;">ZatÃ­m nemÃ¡te vytvoÅ™enÃ© Å¾Ã¡dnÃ© faktury.</p>
      <a href="{% url 'create_invoice' %}" class="btn btn-outline" style="margin-top:1rem;">â• VytvoÅ™it prvnÃ­ fakturu</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
