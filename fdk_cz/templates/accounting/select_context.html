{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "VÃ½bÄ›r ÃºÄetnÃ­ho kontextu" %} | FDK.cz{% endblock %}
{% block header_title %}ğŸ¢ {% trans "ÃšÄetnÃ­ kontexty" %}{% endblock %}
{% block header_subtitle %}{% trans "Vyberte nebo vytvoÅ™te ÃºÄetnÃ­ kontext pro podvojnÃ© ÃºÄetnictvÃ­" %}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <!-- Actions -->
  <div class="mb-6 flex gap-3">
    <a href="{% url 'accounting_dashboard' %}" class="btn btn-outline">â† {% trans "ZpÄ›t na dashboard" %}</a>
  </div>

  <!-- Existing Contexts -->
  {% if contexts %}
  <div class="content-card mb-6">
    <h3 class="text-xl font-semibold mb-4">ğŸ“š {% trans "VaÅ¡e ÃºÄetnÃ­ kontexty" %}</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for ctx in contexts %}
      <div class="p-5 border rounded-lg bg-gray-50 border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition">
        <h4 class="font-semibold text-gray-800 mb-2">{{ ctx.name }}</h4>
        <div class="mb-3">
          <p class="text-sm text-gray-600 mb-1">
            {% if ctx.organization %}
              ğŸ¢ {{ ctx.organization.name }}
            {% else %}
              ğŸ‘¤ {% trans "OsobnÃ­ ÃºÄetnictvÃ­" %}
            {% endif %}
          </p>
          <p class="text-xs text-gray-500">{% trans "Rok" %}: {{ ctx.fiscal_year }}</p>
        </div>
        <div class="flex gap-2">
          <a href="{% url 'set_accounting_context' ctx.context_id %}" class="btn btn-primary btn-sm">
            âœ“ {% trans "Aktivovat" %}
          </a>
          <a href="{% url 'journal_ledger' %}" onclick="event.preventDefault(); window.location='{% url 'set_accounting_context' ctx.context_id %}'; setTimeout(() => window.location='{% url 'journal_ledger' %}', 100);" class="btn btn-outline btn-sm">
            {% trans "DenÃ­k" %}
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Create New Context -->
  <div class="content-card">
    <h3 class="text-xl font-semibold mb-6">â• {% trans "VytvoÅ™it novÃ½ ÃºÄetnÃ­ kontext" %}</h3>

    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <h4 class="font-semibold text-blue-900 mb-2">ğŸ’¡ {% trans "Co je ÃºÄetnÃ­ kontext?" %}</h4>
      <p class="text-sm text-blue-800">
        {% trans "ÃšÄetnÃ­ kontext oddÄ›luje ÃºÄetnictvÃ­ pro rÅ¯znÃ© subjekty (organizace) nebo obdobÃ­. MÅ¯Å¾ete mÃ­t:" %}
      </p>
      <ul class="list-disc list-inside text-sm text-blue-800 mt-2 ml-2">
        <li>{% trans "OsobnÃ­ ÃºÄetnictvÃ­ (individuÃ¡lnÃ­ podnikatel)" %}</li>
        <li>{% trans "ÃšÄetnictvÃ­ pro kaÅ¾dou vaÅ¡i organizaci zvlÃ¡Å¡Å¥" %}</li>
        <li>{% trans "OddÄ›l enÃ© ÃºÄetnictvÃ­ pro rÅ¯znÃ© roky" %}</li>
      </ul>
    </div>

    <form method="POST">
      {% csrf_token %}

      <div class="mb-6">
        <label for="{{ form.name.id_for_label }}" class="form-label" style="display:block;margin-bottom:0.5rem;font-weight:500;color:#374151;">
          {% trans "NÃ¡zev kontextu" %} <span class="text-red-500">*</span>
        </label>
        {{ form.name }}
        <p class="mt-1 text-xs text-gray-500">{% trans "NapÅ™. 'OsobnÃ­ ÃºÄetnictvÃ­ 2025', 'eKultura z.s. - 2025'" %}</p>
        {% if form.name.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.name.errors|join:", " }}</p>
        {% endif %}
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="{{ form.fiscal_year.id_for_label }}" class="form-label" style="display:block;margin-bottom:0.5rem;font-weight:500;color:#374151;">
            {% trans "ÃšÄetnÃ­ rok" %} <span class="text-red-500">*</span>
          </label>
          {{ form.fiscal_year }}
          {% if form.fiscal_year.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.fiscal_year.errors|join:", " }}</p>
          {% endif %}
        </div>

        <div>
          <label for="{{ form.organization.id_for_label }}" class="form-label" style="display:block;margin-bottom:0.5rem;font-weight:500;color:#374151;">
            {% trans "Organizace" %}
          </label>
          {{ form.organization }}
          <p class="mt-1 text-xs text-gray-500">{% trans "Ponechte prÃ¡zdnÃ© pro osobnÃ­ ÃºÄetnictvÃ­" %}</p>
          {% if form.organization.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.organization.errors|join:", " }}</p>
          {% endif %}
        </div>
      </div>

      <div class="mb-6">
        <label for="{{ form.description.id_for_label }}" class="form-label" style="display:block;margin-bottom:0.5rem;font-weight:500;color:#374151;">
          {% trans "Popis" %}
        </label>
        {{ form.description }}
        {% if form.description.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.description.errors|join:", " }}</p>
        {% endif %}
      </div>

      <div class="flex gap-3 pt-6 border-t-2 border-gray-200">
        <button type="submit" class="btn btn-primary">âœ“ {% trans "VytvoÅ™it kontext" %}</button>
        <a href="{% url 'accounting_dashboard' %}" class="btn btn-outline">{% trans "ZruÅ¡it" %}</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
