{% comment %}
Centr√°ln√≠ sidebar menu pro cel√Ω FDK.cz syst√©m
- Aktivn√≠ modul s podmenu je naho≈ôe pod Hlavn√≠
- Kategorie jsou fixn√≠ - jen odkazy bez podmenu
{% endcomment %}

<!-- Hlavn√≠ Section -->
<div class="nav-section">
  <div class="nav-section-title">Hlavn√≠</div>
  <a href="{% url 'index' %}" class="nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
    <span class="nav-icon">&#127968;</span> Dom≈Ø
  </a>
  {% if user.is_authenticated %}
  <a href="{% url 'organization_dashboard' %}" class="nav-item">
    <span class="nav-icon">&#127970;</span> Moje organizace
  </a>

  <!-- Current Context Display -->
  <div style="margin: 0.5rem 0.75rem; padding: 0.5rem; background: {% if current_organization %}#1e40af{% else %}#059669{% endif %}; border-radius: 6px; border-left: 3px solid {% if current_organization %}#3b82f6{% else %}#10b981{% endif %};">
    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem;">
      {% if current_organization %}Organizace{% else %}Kontext{% endif %}
    </div>
    <div style="font-size: 0.9rem; color: #ffffff; font-weight: 600;">
      {% if current_organization %}
        üè¢ {{ current_organization.name }}
      {% else %}
        üë§ Osobn√≠
      {% endif %}
    </div>
    <!-- DEBUG INFO -->
    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5); margin-top: 0.25rem; font-family: monospace;">
      DEBUG: current_org={{ current_organization|default:"None" }}
      {% if current_organization %}(ID: {{ current_organization.organization_id }}){% endif %}
    </div>
    {% if can_switch_organizations %}
    <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.2);">
      {% if current_organization %}
        <a href="{% url 'set_personal_context' %}" style="display: block; padding: 0.25rem 0.5rem; background: rgba(255,255,255,0.2); border-radius: 4px; color: white; font-size: 0.75rem; text-decoration: none; text-align: center; font-weight: 500;">
          üë§ P≈ôepnout na osobn√≠
        </a>
      {% endif %}
      {% for org in user_organizations %}
        {% if not current_organization or org.organization_id != current_organization.organization_id %}
        <a href="{% url 'set_organization_context' org.organization_id %}" style="display: block; padding: 0.25rem 0.5rem; margin-top: 0.25rem; background: rgba(255,255,255,0.2); border-radius: 4px; color: white; font-size: 0.75rem; text-decoration: none; text-align: center; font-weight: 500;">
          üè¢ {{ org.name }}
        </a>
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
  </div>
  {% endif %}
</div>

{% if user.is_authenticated %}

{% comment %} AKTIVN√ç MODUL - zobraz√≠ se naho≈ôe s podmenu {% endcomment %}
{% if active_module %}
<div class="nav-section nav-section-active">
  <div class="nav-section-title">Aktivn√≠</div>
  {% if active_module == 'project_management' %}
    {% include 'inc/menus/project_menu.html' %}
  {% elif active_module == 'task_management' %}
    {% include 'inc/menus/task_menu.html' %}
  {% elif active_module == 'test_management' %}
    {% include 'inc/menus/test_menu.html' %}
  {% elif active_module == 'b2b_management' %}
    {% include 'inc/menus/b2b_menu.html' %}
  {% elif active_module == 'hr_management' %}
    {% include 'inc/menus/hr_menu.html' %}
  {% elif active_module == 'risk_management' %}
    {% include 'inc/menus/risk_menu.html' %}
  {% elif active_module == 'it_management' %}
    {% include 'inc/menus/it_menu.html' %}
  {% elif active_module == 'asset_management' %}
    {% include 'inc/menus/asset_menu.html' %}
  {% elif active_module == 'accounting' %}
    {% include 'inc/menus/accounting_menu.html' %}
  {% elif active_module == 'grants' %}
    {% include 'inc/menus/grants_menu.html' %}
  {% elif active_module == 'contacts' %}
    {% include 'inc/menus/contacts_menu.html' %}
  {% elif active_module == 'contracts' %}
    {% include 'inc/menus/contracts_menu.html' %}
  {% elif active_module == 'lists' %}
    {% include 'inc/menus/lists_menu.html' %}
  {% elif active_module == 'warehouse' %}
    {% include 'inc/menus/warehouse_menu.html' %}
  {% elif active_module == 'law_ai' %}
    {% include 'inc/menus/law_menu.html' %}
  {% elif active_module == 'dms' %}
    {% include 'inc/menus/dms_menu.html' %}
  {% endif %}
</div>
{% endif %}

{% comment %} KATEGORIE: Management {% endcomment %}
<div class="nav-section">
  <div class="nav-section-title">Management</div>
  {% for module in visible_modules %}
    {% if module.name == 'project_management' %}
      <a href="{% url 'index_project_cs' %}" class="nav-item"><span class="nav-icon">&#128295;</span> Spr√°va projekt≈Ø</a>
    {% elif module.name == 'task_management' %}
      <a href="{% url 'task_management' %}" class="nav-item"><span class="nav-icon">&#10004;</span> Spr√°va √∫kol≈Ø</a>
    {% elif module.name == 'test_management' %}
      <a href="{% url 'list_tests' %}" class="nav-item"><span class="nav-icon">&#129514;</span> Testov√°n√≠</a>
    {% elif module.name == 'b2b_management' %}
      <a href="{% url 'b2b_dashboard' %}" class="nav-item"><span class="nav-icon">&#129309;</span> Spr√°va B2B</a>
    {% elif module.name == 'hr_management' %}
      <a href="{% url 'hr_dashboard' %}" class="nav-item"><span class="nav-icon">&#128188;</span> HR Management</a>
    {% elif module.name == 'risk_management' %}
      <a href="{% url 'risk_dashboard' %}" class="nav-item"><span class="nav-icon">&#9888;</span> Spr√°va rizik</a>
    {% elif module.name == 'it_management' %}
      <a href="{% url 'it_dashboard' %}" class="nav-item"><span class="nav-icon">&#128187;</span> Spr√°va IT</a>
    {% elif module.name == 'asset_management' %}
      <a href="{% url 'asset_dashboard' %}" class="nav-item"><span class="nav-icon">&#128203;</span> Spr√°va majetku</a>
    {% endif %}
  {% endfor %}
</div>

{% comment %} KATEGORIE: Finance - zobraz√≠ se jen kdy≈æ m√° nƒõjak√© moduly {% endcomment %}
{% if category_visibility.Finance %}
<div class="nav-section">
  <div class="nav-section-title">Finance</div>
  {% for module in visible_modules %}
    {% if module.name == 'accounting' %}
      <a href="{% url 'accounting_dashboard' %}" class="nav-item"><span class="nav-icon">&#128202;</span> √öƒçetnictv√≠</a>
    {% elif module.name == 'grants' %}
      <a href="{% url 'grant_list' %}" class="nav-item"><span class="nav-icon">&#128176;</span> Granty &amp; Dotace</a>
    {% endif %}
  {% endfor %}
  <a href="{% url 'user_settings' %}" class="nav-item" style="color: #94a3b8; font-size: 0.875rem;">
    <span class="nav-icon">&#128161;</span> Zapnout dal≈°√≠ moduly v nastaven√≠
  </a>
</div>
{% endif %}

{% comment %} KATEGORIE: Business - zobraz√≠ se jen kdy≈æ m√° nƒõjak√© moduly {% endcomment %}
{% if category_visibility.Business %}
<div class="nav-section">
  <div class="nav-section-title">Business</div>
  {% for module in visible_modules %}
    {% if module.name == 'contacts' %}
      <a href="{% url 'my_contacts' %}" class="nav-item"><span class="nav-icon">&#128100;</span> Kontakty</a>
    {% elif module.name == 'contracts' %}
      <a href="{% url 'list_contracts' %}" class="nav-item"><span class="nav-icon">&#128196;</span> Smlouvy</a>
    {% endif %}
  {% endfor %}
  <a href="{% url 'user_settings' %}" class="nav-item" style="color: #94a3b8; font-size: 0.875rem;">
    <span class="nav-icon">&#128161;</span> Zapnout dal≈°√≠ moduly v nastaven√≠
  </a>
</div>
{% endif %}

{% comment %} KATEGORIE: N√°stroje {% endcomment %}
<div class="nav-section">
  <div class="nav-section-title">N√°stroje</div>
  {% for module in visible_modules %}
    {% if module.name == 'lists' %}
      <a href="{% url 'index_list' %}" class="nav-item"><span class="nav-icon">&#128221;</span> Seznamy</a>
    {% elif module.name == 'warehouse' %}
      <a href="{% url 'all_stores' %}" class="nav-item"><span class="nav-icon">&#128230;</span> Sklad</a>
    {% elif module.name == 'law_ai' %}
      <a href="{% url 'pravo_ai' %}" class="nav-item"><span class="nav-icon">&#9889;</span> AI Pr√°vn√≠k</a>
    {% endif %}
  {% endfor %}
  <a href="{% url 'dms_dashboard' %}" class="nav-item"><span class="nav-icon">&#128193;</span> DMS</a>
</div>

<!-- Nastaven√≠ Section -->
<div class="nav-section">
  <div class="nav-section-title">Nastaven√≠</div>
  <a href="{% url 'user_settings' %}" class="nav-item"><span class="nav-icon">&#9881;</span> Nastaven√≠ √∫ƒçtu</a>
  <a href="{% url 'user_settings' %}" class="nav-item"><span class="nav-icon">&#10133;</span> Zapnout moduly</a>
</div>

{% if user.is_superuser or user.is_staff %}
<div class="nav-section">
  <div class="nav-section-title">Administrace</div>
  <a href="{% url 'admin_modules' %}" class="nav-item"><span class="nav-icon">&#128176;</span> Spr√°va modul≈Ø</a>
  <a href="{% url 'admin_subscriptions' %}" class="nav-item"><span class="nav-icon">&#128196;</span> P≈ôedplatn√°</a>
  <a href="{% url 'admin_assign_module' %}" class="nav-item"><span class="nav-icon">&#10133;</span> P≈ôi≈ôadit modul</a>
</div>
{% endif %}

{% else %}
<!-- Menu pro nep≈ôihl√°≈°en√© u≈æivatele -->
<div class="nav-section">
  <div class="nav-section-title">Obl√≠ben√© moduly</div>
  <a href="{% url 'module_project_management' %}" class="nav-item" title="Zjistit v√≠ce o spr√°vƒõ projekt≈Ø">
    <span class="nav-icon">&#128295;</span> Spr√°va projekt≈Ø
  </a>
  <a href="{% url 'module_grants' %}" class="nav-item" title="Zjistit v√≠ce o grantech a dotac√≠ch">
    <span class="nav-icon">&#128176;</span> Granty a dotace
  </a>
  <a href="{% url 'module_accounting' %}" class="nav-item" title="Zjistit v√≠ce o √∫ƒçetnictv√≠">
    <span class="nav-icon">&#128202;</span> √öƒçetnictv√≠
  </a>
  <a href="{% url 'module_law_ai' %}" class="nav-item" title="Zjistit v√≠ce o AI Pr√°vn√≠kovi">
    <span class="nav-icon">&#9889;</span> AI Pr√°vn√≠k
  </a>
  <a href="{% url 'dms_public' %}" class="nav-item" title="Zjistit v√≠ce o DMS">
    <span class="nav-icon">&#128193;</span> DMS
  </a>
</div>

<div class="nav-section">
  <div class="nav-section-title">√öƒçet</div>
  <a href="{% url 'login_cs' %}" class="nav-item">
    <span class="nav-icon">&#128273;</span> P≈ôihl√°sit se
  </a>
  <a href="{% url 'registration_cs' %}" class="nav-item">
    <span class="nav-icon">&#128221;</span> Registrace
  </a>
</div>
{% endif %}
