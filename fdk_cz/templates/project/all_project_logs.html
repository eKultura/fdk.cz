{% extends "base.html" %}
{% load i18n %}

{% block title %}Log aktivit projektÅ¯ | FDK.cz{% endblock %}
{% block header_title %}ğŸ“Š Log aktivit{% endblock %}
{% block header_subtitle %}
PÅ™ehled aktivit ve vaÅ¡ich projektech
{% endblock %}

{% block context_breadcrumbs %}
{% include 'inc/org_context_breadcrumb.html' %}
<span class="breadcrumb-sep">â†’</span>
<a href="{% url 'index_project_cs' %}" class="breadcrumb-link">Projekty</a>
<span class="breadcrumb-sep">â†’</span>
<span style="font-weight: 600; color: #1e293b;">Log aktivit</span>
{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto;">

  <!-- Info box -->
  <div style="margin-bottom: 1.5rem; background: linear-gradient(to right, #fef3c7, #fde68a); border: 2px solid #fbbf24; border-radius: 8px; padding: 1rem;">
    <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
      <span style="color: #92400e;">ğŸ”‘</span>
      <span style="color: #92400e; font-weight: 600;">AdministrÃ¡torskÃ½ pÅ™ehled:</span>
      <span style="color: #78350f;">ZobrazujÃ­ se pouze projekty, kde jste administrÃ¡torem ({{ total_projects }} {% if total_projects == 1 %}projekt{% elif total_projects < 5 %}projekty{% else %}projektÅ¯{% endif %}).</span>
    </div>
  </div>

  {% if projects_with_stats %}
  <!-- Projects with activity logs -->
  <div class="content-card">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
      ğŸ“‹ VaÅ¡e projekty s logy aktivit
    </h2>

    <div class="overflow-x-auto">
      <table class="data-table">
        <thead>
          <tr>
            <th>Projekt</th>
            <th class="hidden md:table-cell">Organizace</th>
            <th>Ãškoly</th>
            <th class="hidden md:table-cell">Dokumenty</th>
            <th>Chyby</th>
            <th class="hidden lg:table-cell">PoslednÃ­ aktivita</th>
            <th class="text-right">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for item in projects_with_stats %}
          <tr>
            <td>
              <a href="{% url 'detail_project' item.project.project_id %}" class="font-semibold text-blue-600 hover:underline">
                {{ item.project.name }}
              </a>
              <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">
                {{ item.total_activities }} aktivit celkem
              </div>
            </td>
            <td class="hidden md:table-cell">
              {% if item.project.organization %}
                <span style="padding: 4px 8px; background: #dbeafe; color: #1e40af; border-radius: 8px; font-size: 0.75rem; font-weight: 600;">
                  ğŸ›ï¸ {{ item.project.organization.name }}
                </span>
              {% else %}
                <span style="padding: 4px 8px; background: #f3e8ff; color: #6b21a8; border-radius: 8px; font-size: 0.75rem; font-weight: 600;">
                  ğŸ‘¤ OsobnÃ­
                </span>
              {% endif %}
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 0.25rem;">
                <span style="font-weight: 600; color: {% if item.completed_task_count == item.task_count and item.task_count > 0 %}#16a34a{% else %}#1e293b{% endif %};">
                  {{ item.completed_task_count }}/{{ item.task_count }}
                </span>
                {% if item.task_count > 0 %}
                  <div style="width: 40px; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                    <div style="width: {% widthratio item.completed_task_count item.task_count 100 %}%; height: 100%; background: #22c55e;"></div>
                  </div>
                {% endif %}
              </div>
            </td>
            <td class="hidden md:table-cell">
              <span style="color: #64748b;">{{ item.doc_count }}</span>
            </td>
            <td>
              {% if item.open_error_count > 0 %}
                <span style="padding: 2px 8px; background: #fee2e2; color: #991b1b; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                  {{ item.open_error_count }} otevÅ™enÃ½ch
                </span>
              {% else %}
                <span style="color: #64748b;">{{ item.error_count }}</span>
              {% endif %}
            </td>
            <td class="hidden lg:table-cell">
              {% if item.last_activity %}
                <div style="font-size: 0.875rem;">
                  <div style="font-weight: 500;">{{ item.last_activity|date:"d.m.Y" }}</div>
                  <div style="color: #64748b; font-size: 0.75rem;">{{ item.last_activity|timesince }}</div>
                </div>
              {% else %}
                <span style="color: #9ca3af; font-size: 0.75rem;">â€”</span>
              {% endif %}
            </td>
            <td class="text-right">
              <div class="data-table-actions">
                <a href="{% url 'project_log' item.project.project_id %}">ğŸ“Š Log</a>
                <a href="{% url 'detail_project' item.project.project_id %}">ğŸ‘ï¸ Detail</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% else %}
  <!-- Empty state -->
  <div class="content-card">
    <div style="text-align: center; padding: 3rem; background: #f8fafc; border-radius: 8px;">
      <span style="font-size: 3rem; display: block; margin-bottom: 0.5rem;">ğŸ“Š</span>
      <p style="color: #64748b; font-size: 1rem; margin-bottom: 1rem;">
        Nejste administrÃ¡torem Å¾Ã¡dnÃ©ho projektu.
      </p>
      <p style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 1.5rem;">
        Pro zobrazenÃ­ logu aktivit musÃ­te bÃ½t administrÃ¡torem alespoÅˆ jednoho projektu.
      </p>
      <a href="{% url 'index_project_cs' %}" class="btn btn-primary">
        ğŸ“ PÅ™ejÃ­t na projekty
      </a>
    </div>
  </div>
  {% endif %}

  <!-- Tips -->
  <div class="content-card" style="margin-top: 1.5rem; background: linear-gradient(135deg, #eff6ff, #dbeafe); border-left: 4px solid #3b82f6;">
    <div style="display: flex; align-items: flex-start; gap: 1rem;">
      <div style="font-size: 2rem;">ğŸ’¡</div>
      <div>
        <h4 style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">O logu aktivit</h4>
        <ul style="font-size: 0.875rem; color: #475569; line-height: 1.6; list-style: disc; padding-left: 1.5rem;">
          <li>Log aktivit zobrazuje vÅ¡echny zmÄ›ny v projektu: Ãºkoly, dokumenty, chyby a komentÃ¡Å™e</li>
          <li>Jako administrÃ¡tor vidÃ­te i smazanÃ© poloÅ¾ky pro Ãºplnou historii</li>
          <li>KliknÄ›te na "ğŸ“Š Log" pro zobrazenÃ­ detailnÃ­ho logu konkrÃ©tnÃ­ho projektu</li>
          <li>Aktivita je seÅ™azena od nejnovÄ›jÅ¡Ã­ po nejstarÅ¡Ã­</li>
        </ul>
      </div>
    </div>
  </div>

</div>
{% endblock %}
