{% extends "base.html" %}
{% load i18n %}

{% block title %}Log projektu {{ project.name }} | FDK.cz{% endblock %}
{% block header_title %}ğŸ“Š Log aktivit projektu{% endblock %}
{% block header_subtitle %}
Historie zmÄ›n a aktivit v projektu <strong>{{ project.name }}</strong>
{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto;">

  <!-- Breadcrumbs -->
  <div style="margin-bottom: 1.5rem; font-size: 0.875rem;">
    <a href="{% url 'index_project_cs' %}" style="color: #3b82f6; text-decoration: none;">ğŸ“ Projekty</a>
    <span style="color: #9ca3af; margin: 0 0.5rem;">â†’</span>
    <a href="{% url 'detail_project' project.project_id %}" style="color: #3b82f6; text-decoration: none;">{{ project.name }}</a>
    <span style="color: #9ca3af; margin: 0 0.5rem;">â†’</span>
    <span style="color: #64748b;">Log aktivit</span>
  </div>

  <!-- Action buttons -->
  <div style="margin-bottom: 1.5rem; display: flex; gap: 0.75rem; justify-content: flex-end;">
    <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">â† ZpÄ›t na projekt</a>
  </div>

  <!-- Info box -->
  <div style="margin-bottom: 1.5rem; background: linear-gradient(to right, #eff6ff, #eef2ff); border: 2px solid #bfdbfe; border-radius: 8px; padding: 1rem;">
    <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
      <span style="color: #64748b;">â„¹ï¸ Informace:</span>
      <span style="color: #1e293b;">Tento log je pÅ™Ã­stupnÃ½ pouze administrÃ¡torÅ¯m projektu. Zobrazuje vÅ¡echny aktivity vÄetnÄ› smazanÃ½ch poloÅ¾ek.</span>
    </div>
  </div>

  <!-- Activities table -->
  <div class="content-card">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
      ğŸ“‹ Historie aktivit
      {% if is_paginated %}
        (celkem {{ page_obj.paginator.count }}, strÃ¡nka {{ page_obj.number }} z {{ page_obj.paginator.num_pages }})
      {% else %}
        ({{ activities|length }})
      {% endif %}
    </h2>

    {% if activities %}
    <div class="overflow-x-auto">
      <table class="data-table">
        <thead>
          <tr>
            <th>Datum a Äas</th>
            <th>Typ aktivity</th>
            <th>NÃ¡zev / Popis</th>
            <th class="hidden md:table-cell">UÅ¾ivatel</th>
            <th class="hidden lg:table-cell">Status</th>
            <th class="text-right">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for activity in activities %}
          <tr class="{% if activity.deleted %}bg-red-50{% endif %}">
            <td class="whitespace-nowrap">
              <div style="font-size: 0.875rem;">
                <div style="font-weight: 600;">{{ activity.timestamp|date:"d.m.Y" }}</div>
                <div style="color: #64748b; font-size: 0.75rem;">{{ activity.timestamp|date:"H:i" }}</div>
              </div>
            </td>
            <td>
              {% if activity.type == 'task_created' %}
                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium">ğŸ“‹ Ãškol vytvoÅ™en</span>
              {% elif activity.type == 'task_completed' %}
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">âœ… Ãškol dokonÄen</span>
              {% elif activity.type == 'task_deleted' %}
                <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium">ğŸ—‘ï¸ Ãškol smazÃ¡n</span>
              {% elif activity.type == 'document_created' %}
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">ğŸ“„ Dokument</span>
              {% elif activity.type == 'error_created' %}
                <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-medium">ğŸ› Chyba</span>
              {% elif activity.type == 'error_resolved' %}
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">âœ… Chyba vyÅ™eÅ¡ena</span>
              {% elif activity.type == 'error_deleted' %}
                <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium">ğŸ—‘ï¸ Chyba smazÃ¡na</span>
              {% elif activity.type == 'comment_created' %}
                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium">ğŸ’¬ KomentÃ¡Å™</span>
              {% endif %}
            </td>
            <td>
              <div style="max-width: 400px;">
                <div style="font-weight: 600; color: #1e293b; {% if activity.deleted %}text-decoration: line-through;{% endif %}">
                  {{ activity.title|safe }}
                </div>
                <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">
                  {{ activity.description|safe|truncatewords:15 }}
                </div>
              </div>
            </td>
            <td class="hidden md:table-cell">
              {% if activity.user %}
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <span style="background: #e0e7ff; color: #3730a3; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500;">
                    ğŸ‘¤ {{ activity.user.username }}
                  </span>
                </div>
              {% else %}
                <span style="color: #9ca3af; font-size: 0.75rem;">â€”</span>
              {% endif %}
            </td>
            <td class="hidden lg:table-cell">
              {% if activity.status %}
                <span class="px-2 py-1 rounded text-xs font-medium
                  {% if activity.status == 'Hotovo' or activity.status == 'UzavÅ™enÃ¡' %}bg-green-100 text-green-700
                  {% elif activity.status == 'ProbÃ­hÃ¡' or activity.status == 'V procesu' %}bg-yellow-100 text-yellow-800
                  {% else %}bg-gray-100 text-gray-700{% endif %}">
                  {{ activity.status }}
                </span>
              {% else %}
                <span style="color: #9ca3af; font-size: 0.75rem;">â€”</span>
              {% endif %}
            </td>
            <td class="text-right">
              <div class="data-table-actions">
                {% if activity.type == 'task_created' or activity.type == 'task_deleted' or activity.type == 'task_completed' %}
                  {% if not activity.deleted %}
                    <a href="{% url 'detail_task' activity.object.task_id %}" style="color: #3b82f6;">ğŸ‘ï¸ Detail</a>
                  {% else %}
                    <span style="color: #9ca3af; font-size: 0.75rem;">SmazÃ¡no</span>
                  {% endif %}
                {% elif activity.type == 'document_created' %}
                  <a href="{% url 'detail_document' activity.object.document_id %}" style="color: #3b82f6;">ğŸ‘ï¸ Detail</a>
                {% elif activity.type == 'error_created' or activity.type == 'error_deleted' or activity.type == 'error_resolved' %}
                  {% if not activity.deleted %}
                    <a href="{% url 'detail_test_error' activity.object.test_error_id %}" style="color: #3b82f6;">ğŸ‘ï¸ Detail</a>
                  {% else %}
                    <span style="color: #9ca3af; font-size: 0.75rem;">SmazÃ¡no</span>
                  {% endif %}
                {% elif activity.type == 'comment_created' %}
                  <a href="{% url 'detail_task' activity.object.task.task_id %}" style="color: #3b82f6;">ğŸ‘ï¸ Ãškol</a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination controls -->
    {% if is_paginated %}
    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <!-- Previous page button -->
        <div>
          {% if page_obj.has_previous %}
            <a href="?page=1" class="btn btn-outline btn-sm" style="margin-right: 0.5rem;">â€¹â€¹ PrvnÃ­</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline btn-sm">â€¹ PÅ™edchozÃ­</a>
          {% else %}
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed; margin-right: 0.5rem;">â€¹â€¹ PrvnÃ­</span>
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">â€¹ PÅ™edchozÃ­</span>
          {% endif %}
        </div>

        <!-- Page info -->
        <div style="color: #64748b; font-size: 0.875rem;">
          StrÃ¡nka <strong>{{ page_obj.number }}</strong> z <strong>{{ page_obj.paginator.num_pages }}</strong>
          (celkem {{ page_obj.paginator.count }} aktivit)
        </div>

        <!-- Next page button -->
        <div>
          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline btn-sm">NÃ¡sledujÃ­cÃ­ â€º</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-outline btn-sm" style="margin-left: 0.5rem;">PoslednÃ­ â€ºâ€º</a>
          {% else %}
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">NÃ¡sledujÃ­cÃ­ â€º</span>
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed; margin-left: 0.5rem;">PoslednÃ­ â€ºâ€º</span>
          {% endif %}
        </div>
      </div>

      <!-- Page number links -->
      <div style="margin-top: 1rem; text-align: center;">
        {% for page_num in page_obj.paginator.page_range %}
          {% if page_num == page_obj.number %}
            <span style="display: inline-block; padding: 0.375rem 0.75rem; margin: 0 0.125rem; background: #3b82f6; color: white; border-radius: 4px; font-weight: 600; font-size: 0.875rem;">
              {{ page_num }}
            </span>
          {% elif page_num > page_obj.number|add:-3 and page_num < page_obj.number|add:3 %}
            <a href="?page={{ page_num }}" style="display: inline-block; padding: 0.375rem 0.75rem; margin: 0 0.125rem; background: #f1f5f9; color: #475569; border-radius: 4px; text-decoration: none; font-size: 0.875rem; transition: background 0.2s;">
              {{ page_num }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% else %}
    <div style="text-align: center; padding: 3rem; background: #f8fafc; border-radius: 8px;">
      <span style="font-size: 3rem; display: block; margin-bottom: 0.5rem;">ğŸ“Š</span>
      <p style="color: #64748b; font-size: 1rem;">ZatÃ­m Å¾Ã¡dnÃ© aktivity v tomto projektu.</p>
    </div>
    {% endif %}
  </div>

  <!-- Statistics -->
  <div class="content-card" style="margin-top: 2rem;">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ Statistika aktivit</h2>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
      <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-4">
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Celkem aktivit</div>
        <div class="text-3xl font-bold text-gray-700">
          {% if is_paginated %}{{ page_obj.paginator.count }}{% else %}{{ activities|length }}{% endif %}
        </div>
      </div>

      <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
        <div class="text-xs font-semibold text-blue-700 uppercase tracking-wide mb-1">Ãškoly</div>
        <div class="text-3xl font-bold text-blue-600">
          {{ project.tasks.count }}
        </div>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4">
        <div class="text-xs font-semibold text-green-700 uppercase tracking-wide mb-1">Dokumenty</div>
        <div class="text-3xl font-bold text-green-600">
          {{ project.documents.count }}
        </div>
      </div>

      <div class="bg-orange-50 border-2 border-orange-200 rounded-lg p-4">
        <div class="text-xs font-semibold text-orange-700 uppercase tracking-wide mb-1">Chyby z testovÃ¡nÃ­</div>
        <div class="text-3xl font-bold text-orange-600">
          {{ project.test_errors.count }}
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
