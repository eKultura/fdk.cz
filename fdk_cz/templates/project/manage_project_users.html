{% extends "base.html" %}
{% load i18n %}

{% block title %}SprÃ¡va uÅ¾ivatelÅ¯ projektu | FDK.cz{% endblock %}
{% block header_title %}SprÃ¡va uÅ¾ivatelÅ¯{% endblock %}
{% block header_subtitle %}PÅ™idÃ¡vejte a spravujte Äleny tÃ½mu pro projekt <strong>{{ project.name }}</strong>{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">

  <!-- SdÃ­lenÃ½ odkaz projektu -->
  <div class="content-card" style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border-left: 4px solid #3b82f6;">
    <h3 style="font-weight:600;font-size:1.1rem;margin-bottom:1rem; color: #1e40af;">ğŸ”— SdÃ­lenÃ½ odkaz projektu</h3>

    <p style="color: #475569; margin-bottom: 1rem; font-size: 0.95rem;">
      SdÃ­lejte tento odkaz s kolegy - po pÅ™ihlÃ¡Å¡enÃ­ se automaticky pÅ™idajÃ­ do projektu:
    </p>

    <div style="display: flex; gap: 0.5rem; align-items: center;">
      <input type="text"
             id="project_share_link"
             readonly
             value="{{ request.scheme }}://{{ request.get_host }}{% url 'join_project' project.project_id %}"
             style="flex: 1; padding: 0.75rem; border: 2px solid #3b82f6; border-radius: 6px; font-family: monospace; font-size: 0.9rem; background: white;">
      <button onclick="copyShareLink()"
              class="btn btn-primary"
              style="white-space: nowrap;">
        ğŸ“‹ ZkopÃ­rovat
      </button>
    </div>

    <p style="color: #64748b; margin-top: 0.75rem; font-size: 0.85rem;">
      ğŸ’¡ Tento odkaz mohou pouÅ¾Ã­t i neregistrovanÃ­ uÅ¾ivatelÃ© - budou vyzvÃ¡ni k registraci.
    </p>
  </div>

  <!-- FormulÃ¡Å™ pro pÅ™idÃ¡nÃ­ Älena pÅ™es email -->
  <div class="content-card" style="margin-top: 1.5rem;">
    <h3 style="font-weight:600;font-size:1.1rem;margin-bottom:1rem;">â• PÅ™idat Älena pÅ™es email</h3>

    <form method="post" style="margin-bottom:1.5rem;">
      {% csrf_token %}

      <div class="form-group">
        <label for="id_email" class="form-label">{{ form.email.label }}</label>
        {{ form.email }}
        <div class="form-help">{{ form.email.help_text }}</div>
        {% if form.email.errors %}
          <div class="form-error">{{ form.email.errors|join:", " }}</div>
        {% endif %}
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="id_role" class="form-label">{{ form.role.label }} <span class="required">*</span></label>
          {{ form.role }}
          {% if form.role.errors %}
            <div class="form-error">{{ form.role.errors|join:", " }}</div>
          {% endif %}
        </div>

        <div class="form-group">
          <label class="form-label" style="opacity: 0;">Placeholder</label>
          <div class="form-check">
            {{ form.send_invitation }}
            <label for="id_send_invitation" class="form-check-label">{{ form.send_invitation.label }}</label>
          </div>
          <div class="form-help">{{ form.send_invitation.help_text }}</div>
        </div>
      </div>

      <div style="text-align: right; margin-top: 1rem;">
        <button type="submit" class="btn btn-primary">âœ‰ï¸ PÅ™idat uÅ¾ivatele</button>
      </div>
    </form>
  </div>

  <!-- Seznam ÄlenÅ¯ projektu -->
  <div class="content-card" style="margin-top: 1.5rem;">
    <h3 style="font-weight:600;font-size:1.1rem;margin-bottom:1rem;">ğŸ‘¥ ÄŒlenovÃ© projektu ({{ members.count }})</h3>

    {% if members %}
    <div style="overflow-x:auto;">
      <table class="data-table">
        <thead>
          <tr>
            <th>UÅ¾ivatel</th>
            <th>Email</th>
            <th>Role</th>
            <th class="text-center">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
          <tr>
            <td>
              <strong>{{ member.user.username }}</strong>
              {% if member.user == project.created_by %}
                <span style="background: #eff6ff; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-left: 0.5rem;">ğŸ‘‘ VedoucÃ­</span>
              {% endif %}
            </td>
            <td style="color: #64748b; font-size: 0.9rem;">{{ member.user.email }}</td>
            <td>{{ member.role.role_name }}</td>
            <td class="text-center">
              {% if member.user != project.created_by %}
                <a href="{% url 'remove_project_user' project.project_id member.user.id %}"
                   class="danger"
                   onclick="return confirm('Opravdu chcete odebrat uÅ¾ivatele {{ member.user.username }} z projektu?');">
                  ğŸ—‘ï¸ Odebrat
                </a>
              {% else %}
                <span style="color: #9ca3af; font-size: 0.85rem;">VedoucÃ­ projektu</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div style="text-align:center;padding:2rem;background:#f8fafc;border-radius:8px;">
      <div style="font-size:3rem;margin-bottom:0.5rem;">ğŸ¤</div>
      <p style="color:#64748b;">ZatÃ­m nejsou pÅ™idÃ¡ni Å¾Ã¡dnÃ­ ÄlenovÃ© projektu.</p>
    </div>
    {% endif %}
  </div>

  <!-- ZpÄ›t na projekt -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">â† ZpÄ›t na projekt</a>
  </div>

</div>

<script>
function copyShareLink() {
  const input = document.getElementById('project_share_link');
  input.select();
  input.setSelectionRange(0, 99999); // For mobile

  navigator.clipboard.writeText(input.value).then(() => {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = 'âœ… ZkopÃ­rovÃ¡no!';
    btn.style.background = 'linear-gradient(135deg, #059669, #047857)';

    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.background = '';
    }, 2000);
  });
}
</script>
{% endblock %}
