{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ task.title }} | Detail Ãºkolu | FDK.cz{% endblock %}
{% block header_title %}{{ task.title }}{% endblock %}
{% block header_subtitle %}
Ãškol v projektu <strong>{{ project.name }}</strong> &middot; Stav: {{ task.status|default:"NedefinovÃ¡n" }}
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="content-card">

    <!-- ZÃ¡kladnÃ­ Ãºdaje o Ãºkolu -->
    <div class="mb-6">
      <p><strong>Status:</strong> {{ task.status|default:"NedefinovÃ¡n" }}</p>
      <p><strong>Popis:</strong> {{ task.description|default:"-" }}</p>
      <p><strong>Kategorie:</strong> {{ task.category.name|default:"-" }}</p>
      <p><strong>Priorita:</strong> {{ task.priority|default:"-" }}</p>
      <p><strong>VytvoÅ™eno:</strong> {{ task.created|date:"d.m.Y" }}</p>
      <p><strong>PÅ™iÅ™azeno:</strong>
        {% if task.assigned %}
          {{ task.assigned.username }}
        {% else %}
          <span class="text-gray-500">NepÅ™iÅ™azeno</span>
        {% endif %}
      </p>
      <p><strong>TermÃ­n dokonÄenÃ­:</strong> {{ task.due_date|date:"d.m.Y"|default:"â€“" }}</p>

      {% if task.parent %}
      <p><strong>NadÅ™azenÃ½ Ãºkol:</strong>
        <a href="{% url 'detail_task' task.parent.task_id %}" class="text-blue-600 hover:underline">
          {{ task.parent.title }}
        </a>
      </p>
      {% endif %}

      {% if task.subtasks.exists %}
      <div class="mt-4">
        <h3 class="font-semibold text-gray-800 mb-1">PodÃºkoly</h3>
        <ul class="list-disc list-inside ml-4 text-gray-700">
          {% for subtask in task.subtasks.all %}
            <li><a href="{% url 'detail_task' subtask.task_id %}" class="text-blue-600 hover:underline">{{ subtask.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>

    <!-- Akce -->
    <div class="flex flex-wrap gap-3 mt-4 border-t border-gray-200 pt-4">
      <form action="{% url 'update_task_status' task.task_id 'Hotovo' %}" method="post" class="inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">âœ… Hotovo</button>
      </form>
      <a href="{% url 'edit_task' task.task_id %}" class="btn btn-primary">âœï¸ Upravit</a>
      <a href="{% url 'delete_task' task.task_id %}" class="btn btn-danger" onclick="return confirm('Opravdu chcete smazat tento Ãºkol?');">
        ğŸ—‘ï¸ Smazat
      </a>
      <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">â† ZpÄ›t na projekt</a>
    </div>

    <!-- KomentÃ¡Å™e -->
    <div class="mt-8 border-t border-gray-200 pt-4">
      <h3 class="text-xl font-semibold text-gray-800 mb-3">ğŸ’¬ KomentÃ¡Å™e</h3>

      {% if comments %}
      <div class="space-y-3 mb-6">
        {% for comment in comments %}
        <div class="p-3 bg-gray-50 rounded border border-gray-200">
          <p class="text-sm text-gray-700">
            <strong>{{ comment.user.username|default:"Anonym" }}</strong> Â· {{ comment.posted|date:"d.m.Y H:i" }}
          </p>
          <p class="text-gray-800 mt-1">{{ comment.comment }}</p>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-gray-500 mb-4">ZatÃ­m Å¾Ã¡dnÃ© komentÃ¡Å™e.</p>
      {% endif %}

      <form method="post" action="{% url 'detail_task' task.task_id %}">
        {% csrf_token %}
        <textarea name="comment" rows="3" class="w-full p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 mb-3" placeholder="PÅ™idat komentÃ¡Å™..."></textarea>
        <button type="submit" class="btn btn-primary">ğŸ’¬ PÅ™idat komentÃ¡Å™</button>
      </form>
    </div>

  </div>
</div>
{% endblock %}
