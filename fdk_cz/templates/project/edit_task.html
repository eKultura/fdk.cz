{% extends "base.html" %}
{% load i18n %}

{% block title %}Upravit 칰kol | FDK.cz{% endblock %}
{% block header_title %}Upravit 칰kol{% endblock %}
{% block header_subtitle %}
{% if project %}
Upravte detaily 칰kolu v projektu <strong>{{ project.name }}</strong>
{% else %}
Upravte detaily osobn칤ho 칰kolu
{% endif %}
{% endblock %}

{% block meta %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="content-card">
    <form method="POST">
      {% csrf_token %}

      <!-- N치zev -->
      <div class="form-group">
        <label for="id_title" class="form-label">N치zev 칰kolu <span class="required">*</span></label>
        <input type="text" id="id_title" name="title" required
               value="{{ form.title.value|default:task.title|default:'' }}"
               placeholder="Nap콏. Implementovat login funkcionalitu, Opravit bug v dashboardu"
               class="form-control">
        {% if form.title.errors %}
          <p class="form-error">{{ form.title.errors|join:", " }}</p>
        {% endif %}
      </div>

      <!-- Popis -->
      <div class="form-group">
        <label for="id_description" class="form-label">Popis</label>
        <textarea id="id_description" name="description" rows="6"
                  placeholder="Detailn칤 popis 칰kolu, co je pot콏eba ud캩lat..."
                  class="form-control">{{ form.description.value|default:task.description|default:'' }}</textarea>
        {% if form.description.errors %}
          <p class="form-error">{{ form.description.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">Popi코te co je pot콏eba ud캩lat a jak칠 jsou o캜ek치van칠 v칳sledky. Textov칳 editor s podporou form치tov치n칤.</div>
      </div>

      <!-- Kategorie - pouze pro 칰koly v projektu -->
      {% if project %}
      <div class="form-group">
        <label for="id_category" class="form-label">Kategorie <span class="required">*</span></label>
        <select id="id_category" name="category" required class="form-control">
          <option value="">-- Vyberte kategorii --</option>
          {% for category in form.category.field.queryset %}
            <option value="{{ category.pk }}"
                    {% if task.category and category.pk == task.category.pk %}selected{% endif %}>
              {{ category.name }}
            </option>
          {% endfor %}
        </select>
        {% if form.category.errors %}
          <p class="form-error">{{ form.category.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">P콏i콏a캞te 칰kol do p콏칤slu코n칠 kategorie pro lep코칤 organizaci</div>
      </div>
      {% endif %}

      <!-- Priorita a Status vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_priority" class="form-label">Priorita</label>
          <select id="id_priority" name="priority" class="form-control">
            <option value="N칤zk치" {% if task.priority == "N칤zk치" %}selected{% endif %}>N칤zk치</option>
            <option value="St콏edn칤" {% if task.priority == "St콏edn칤" %}selected{% endif %}>St콏edn칤</option>
            <option value="Vysok치" {% if task.priority == "Vysok치" %}selected{% endif %}>Vysok치</option>
            <option value="Nice to have" {% if task.priority == "Nice to have" %}selected{% endif %}>Nice to have</option>
          </select>
          <div class="form-help">Ur캜ete d콢le쬴tost 칰kolu</div>
        </div>

        <div class="form-group">
          <label for="id_status" class="form-label">Status</label>
          <select id="id_status" name="status" class="form-control">
            <option value="Nezah치jeno" {% if task.status == "Nezah치jeno" %}selected{% endif %}>Nezah치jeno</option>
            <option value="Prob칤h치" {% if task.status == "Prob칤h치" %}selected{% endif %}>Prob칤h치</option>
            <option value="Hotovo" {% if task.status == "Hotovo" %}selected{% endif %}>Hotovo</option>
          </select>
          <div class="form-help">Aktu치ln칤 stav 칰kolu</div>
        </div>
      </div>

      <!-- Datum dokon캜en칤 a P콏id캩leno vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_due_date" class="form-label">Datum dokon캜en칤</label>
          <input type="date" name="due_date" id="id_due_date"
                 value="{{ form.due_date.value|default:task.due_date|date:'Y-m-d'|default:'' }}"
                 class="form-control">
          {% if form.due_date.errors %}
            <p class="form-error">{{ form.due_date.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Pl치novan칳 term칤n dokon캜en칤 칰kolu</div>
        </div>

        <div class="form-group">
          <label for="id_assigned" class="form-label">P콏id캩leno</label>
          <select id="id_assigned" name="assigned" class="form-control">
            <option value="">-- Nep콏i콏azeno --</option>
            {% if project %}
              {% for member in project.project_users.all %}
                <option value="{{ member.user.id }}"
                        {% if task.assigned and member.user.id == task.assigned.id %}selected{% endif %}>
                  {{ member.user.username }}
                </option>
              {% endfor %}
            {% else %}
              {# Pro osobn칤 칰koly bez projektu - zobrazit jen sou캜asn칠ho u쬴vatele #}
              <option value="{{ user.id }}"
                      {% if task.assigned and user.id == task.assigned.id %}selected{% endif %}>
                {{ user.username }} (j치)
              </option>
            {% endif %}
          </select>
          {% if form.assigned.errors %}
            <p class="form-error">{{ form.assigned.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Vyberte osobu odpov캩dnou za 칰kol</div>
        </div>
      </div>

      <!-- Tla캜칤tka -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        {% if project %}
          <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">Zru코it</a>
        {% else %}
          <a href="{% url 'task_management' %}" class="btn btn-outline">Zru코it</a>
        {% endif %}
        <button type="submit" class="btn btn-primary">游 Ulo쬴t zm캩ny</button>
      </div>
    </form>
  </div>
</div>

<!-- Inicializace Summernote -->
<script>
  $(document).ready(function() {
    $('#id_description').summernote({
      placeholder: 'Detailn칤 popis 칰kolu, co je pot콏eba ud캩lat...',
      tabsize: 2,
      height: 200,
      toolbar: [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['font', ['fontsize', 'color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']],
        ['insert', ['link']],
        ['view', ['fullscreen', 'codeview']]
      ]
    });
  });
</script>
{% endblock %}
