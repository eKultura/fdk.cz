{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Projekty | FDK.cz" %}{% endblock %}
{% block header_title %}{% trans "Projekty" %}{% endblock %}
{% block header_subtitle %}{% trans "Spravujte svÃ© projekty pÅ™ehlednÄ› a efektivnÄ›" %}{% endblock %}

{% block context_breadcrumbs %}
  <span class="breadcrumb-link" style="font-weight: 600; color: #1e293b;">{% trans "Projekty" %}</span>
{% endblock %}

{% block content %}

<!-- Context Indicator -->
<div style="margin-bottom: 1.5rem; padding: 0.75rem 1rem; background: {% if current_organization %}linear-gradient(to right, #dbeafe, #eff6ff){% else %}linear-gradient(to right, #d1fae5, #ecfdf5){% endif %}; border-left: 4px solid {% if current_organization %}#3b82f6{% else %}#10b981{% endif %}; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
  <div>
    <span style="font-size: 0.875rem; color: #64748b; font-weight: 500;">ğŸ“ AktuÃ¡lnÃ­ kontext:</span>
    <span style="font-size: 1rem; font-weight: 700; color: {% if current_organization %}#1e40af{% else %}#065f46{% endif %}; margin-left: 0.5rem;">
      {% if current_organization %}
        ğŸ¢ {{ current_organization.name }}
      {% else %}
        ğŸ‘¤ OsobnÃ­
      {% endif %}
    </span>
  </div>
  {% if can_switch_organizations %}
  <div style="display: flex; gap: 0.5rem;">
    {% if current_organization %}
      <a href="{% url 'set_personal_context' %}" style="padding: 0.375rem 0.75rem; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 6px; font-size: 0.875rem; font-weight: 600; text-decoration: none; transition: all 0.2s;" onmouseover="this.style.background='#10b981'; this.style.color='white';" onmouseout="this.style.background='white'; this.style.color='#10b981';">
        ğŸ‘¤ PÅ™epnout na osobnÃ­
      </a>
    {% endif %}
    {% for org in user_organizations %}
      {% if not current_organization or org.organization_id != current_organization.organization_id %}
      <a href="{% url 'set_organization_context' org.organization_id %}" style="padding: 0.375rem 0.75rem; background: white; border: 2px solid #3b82f6; color: #3b82f6; border-radius: 6px; font-size: 0.875rem; font-weight: 600; text-decoration: none; transition: all 0.2s;" onmouseover="this.style.background='#3b82f6'; this.style.color='white';" onmouseout="this.style.background='white'; this.style.color='#3b82f6';">
        ğŸ¢ {{ org.name|truncatewords:3 }}
      </a>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>

<!-- Quick Actions Bar -->
<div style="display: flex; gap: 0.75rem; margin-bottom: 2rem; flex-wrap: wrap;">
  {% with url="new_project_cs" icon="ğŸ“" label="NovÃ½ projekt" %}
    {% include 'inc/components.html' with component='quick_action' %}
  {% endwith %}

  {% with url="task_management" icon="âœ“" label="SprÃ¡va ÃºkolÅ¯" %}
    {% include 'inc/components.html' with component='quick_action' %}
  {% endwith %}

  {% with url="gantt_chart" icon="ğŸ“Š" label="Gantt diagram" %}
    {% include 'inc/components.html' with component='quick_action' %}
  {% endwith %}
</div>

<!-- Active Projects -->
<div style="margin-bottom: 3rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
      <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">{% trans "AktivnÃ­ projekty" %}</h2>
      <p style="color: #64748b; margin: 0; font-size: 0.875rem;">{{ user_projects|length|default:0 }} {% if user_projects|length == 1 %}projekt{% elif user_projects|length < 5 %}projekty{% else %}projektÅ¯{% endif %}</p>
    </div>
    <a href="{% url 'new_project_cs' %}" class="btn btn-primary">
      â• {% trans "NovÃ½ projekt" %}
    </a>
  </div>

  {% if user_projects %}
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
    {% for project in user_projects %}
      {% with project=project %}
        {% include 'inc/components.html' with component='project_card' %}
      {% endwith %}
    {% endfor %}
  </div>
  {% else %}
    {% with icon="ğŸ“" title="Å½Ã¡dnÃ© projekty" message="ZaÄnÄ›te vytvoÅ™enÃ­m novÃ©ho projektu" action_url="new_project_cs" action_label="NovÃ½ projekt" %}
      {% include 'inc/components.html' with component='empty_state' %}
    {% endwith %}
  {% endif %}
</div>

<!-- Archived Projects -->
{% if archived_projects %}
<div class="content-card" style="border: 2px solid #e5e7eb; background: linear-gradient(to bottom, #f9fafb, #ffffff);">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
      <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0; color: #6b7280;">ğŸ“¦ {% trans "Archiv projektÅ¯" %}</h3>
      <p style="color: #9ca3af; margin: 0; font-size: 0.875rem;">
        {{ archived_projects.paginator.count }} {% if archived_projects.paginator.count == 1 %}projekt{% elif archived_projects.paginator.count < 5 %}projekty{% else %}projektÅ¯{% endif %}
        {% if archived_projects.paginator.num_pages > 1 %}(strÃ¡nka {{ archived_projects.number }} z {{ archived_projects.paginator.num_pages }}){% endif %}
      </p>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
    {% for project in archived_projects %}
    <a href="{% url 'detail_project' project.project_id %}" class="project-card" style="opacity: 0.75; filter: grayscale(20%);">
      <div class="project-card-header">
        <h3 class="project-card-title" style="color: #6b7280;">{{ project.name|safe }}</h3>
        {% if project.organization %}
          <span class="badge badge-org" style="background: #f3f4f6; color: #6b7280;">ğŸ¢ {{ project.organization.name }}</span>
        {% else %}
          <span class="badge" style="background: #fef3c7; color: #92400e; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">ğŸ‘¤ OsobnÃ­</span>
        {% endif %}
      </div>

      {% if project.description %}
      <p class="project-card-description" style="color: #9ca3af;">{{ project.description|truncatewords:15|safe }}</p>
      {% endif %}

      <div class="project-card-stats">
        {% if project.owner %}
        <div class="project-stat">
          <span class="project-stat-icon">ğŸ‘¤</span>
          <span class="project-stat-label">{{ project.owner.get_full_name|default:project.owner.username|truncatewords:2 }}</span>
        </div>
        {% endif %}

        {% if project.end_date %}
        <div class="project-stat">
          <span class="project-stat-icon">ğŸ</span>
          <span class="project-stat-label">{{ project.end_date|date:"d.m.Y" }}</span>
        </div>
        {% endif %}
      </div>
    </a>
    {% endfor %}
  </div>

  <!-- Pagination for archived projects -->
  {% if archived_projects.paginator.num_pages > 1 %}
  <div style="margin-top: 2rem; display: flex; justify-content: center; gap: 0.5rem; align-items: center;">
    {% if archived_projects.has_previous %}
      <a href="?archived_page=1" class="btn btn-secondary" style="padding: 0.5rem 1rem;">Â« PrvnÃ­</a>
      <a href="?archived_page={{ archived_projects.previous_page_number }}" class="btn btn-secondary" style="padding: 0.5rem 1rem;">â€¹ PÅ™edchozÃ­</a>
    {% endif %}

    <span style="color: #6b7280; font-weight: 500;">
      StrÃ¡nka {{ archived_projects.number }} z {{ archived_projects.paginator.num_pages }}
    </span>

    {% if archived_projects.has_next %}
      <a href="?archived_page={{ archived_projects.next_page_number }}" class="btn btn-secondary" style="padding: 0.5rem 1rem;">DalÅ¡Ã­ â€º</a>
      <a href="?archived_page={{ archived_projects.paginator.num_pages }}" class="btn btn-secondary" style="padding: 0.5rem 1rem;">PoslednÃ­ Â»</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endif %}

{% endblock %}
