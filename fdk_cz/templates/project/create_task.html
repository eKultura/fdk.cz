{% extends "base.html" %}
{% load i18n %}

{% block title %}Nový úkol | FDK.cz{% endblock %}
{% block header_title %}Nový úkol{% endblock %}
{% block header_subtitle %}Založení nového úkolu v projektu{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="content-card">
    <form method="post">
      {% csrf_token %}

      <!-- Název -->
      <div class="form-group">
        <label for="id_title" class="form-label">Název úkolu <span class="required">*</span></label>
        <input type="text" name="title" id="id_title" required
               value="{{ form.title.value|default_if_none:'' }}"
               placeholder="Např. Implementovat login funkcionalitu, Opravit bug v dashboardu"
               class="form-control">
        {% if form.title.errors %}
          <p class="form-error">{{ form.title.errors|join:", " }}</p>
        {% endif %}
      </div>

      <!-- Popis -->
      <div class="form-group">
        <label for="id_description" class="form-label">Popis</label>
        <textarea name="description" id="id_description" rows="6"
                  placeholder="Detailní popis úkolu, co je potřeba udělat...

Podporuje Markdown: **tučně**, *kurzíva*, `kód`, [odkaz](url), # Nadpisy"
                  class="form-control">{{ form.description.value|default_if_none:'' }}</textarea>
        {% if form.description.errors %}
          <p class="form-error">{{ form.description.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">Popište co je potřeba udělat a jaké jsou očekávané výsledky. Podporuje <strong>Markdown</strong> formátování (např. **tučně**, *kurzíva*, `kód`, [odkaz](url)).</div>
      </div>

      <!-- Kategorie -->
      <div class="form-group">
        <label for="id_category" class="form-label">Kategorie <span class="required">*</span></label>
        <select name="category" id="id_category" class="form-control" required>
          <option value="">-- Vyberte kategorii --</option>
          {% for category in form.category.field.queryset %}
            <option value="{{ category.pk }}"
                    {% if form.category.value == category.pk %}selected{% endif %}>
              {{ category.name }}
            </option>
          {% endfor %}
        </select>
        {% if form.category.errors %}
          <p class="form-error">{{ form.category.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">Přiřaďte úkol do příslušné kategorie pro lepší organizaci</div>
      </div>

      <!-- Priorita a Status vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_priority" class="form-label">Priorita</label>
          <select name="priority" id="id_priority" class="form-control">
            <option value="Nízká" {% if form.priority.value == "Nízká" %}selected{% endif %}>Nízká</option>
            <option value="Střední" {% if form.priority.value == "Střední" %}selected{% endif %}>Střední</option>
            <option value="Vysoká" {% if form.priority.value == "Vysoká" %}selected{% endif %}>Vysoká</option>
            <option value="Nice to have" {% if form.priority.value == "Nice to have" %}selected{% endif %}>Nice to have</option>
          </select>
          <div class="form-help">Určete důležitost úkolu</div>
        </div>

        <div class="form-group">
          <label for="id_status" class="form-label">Status</label>
          <select name="status" id="id_status" class="form-control">
            <option value="Nezahájeno" {% if form.status.value == "Nezahájeno" %}selected{% endif %}>Nezahájeno</option>
            <option value="Probíhá" {% if form.status.value == "Probíhá" %}selected{% endif %}>Probíhá</option>
            <option value="Hotovo" {% if form.status.value == "Hotovo" %}selected{% endif %}>Hotovo</option>
          </select>
          <div class="form-help">Aktuální stav úkolu</div>
        </div>
      </div>

      <!-- Datum dokončení a Přiděleno vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_due_date" class="form-label">Datum dokončení</label>
          <input type="date" name="due_date" id="id_due_date"
                 value="{{ form.due_date.value|default_if_none:'' }}"
                 class="form-control">
          {% if form.due_date.errors %}
            <p class="form-error">{{ form.due_date.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Plánovaný termín dokončení úkolu</div>
        </div>

        <div class="form-group">
          <label for="id_assigned" class="form-label">Přiděleno</label>
          <select name="assigned" id="id_assigned" class="form-control">
            <option value="">-- Nepřiřazeno --</option>
            {% for member in project.project_users.all %}
              <option value="{{ member.user.id }}"
                      {% if form.assigned.value == member.user.id %}selected{% endif %}>
                {{ member.user.username }}
              </option>
            {% endfor %}
          </select>
          {% if form.assigned.errors %}
            <p class="form-error">{{ form.assigned.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Vyberte osobu odpovědnou za úkol</div>
        </div>
      </div>

      <!-- Akce -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">Zrušit</a>
        <button type="submit" class="btn btn-primary">➕ Vytvořit úkol</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
