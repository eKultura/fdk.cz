{% extends "base.html" %}
{% load i18n %}

{% block title %}Nov√Ω √∫kol | FDK.cz{% endblock %}
{% block header_title %}Nov√Ω √∫kol{% endblock %}
{% block header_subtitle %}Zalo≈æen√≠ nov√©ho √∫kolu v projektu{% endblock %}

{% block meta %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<div style="margin-bottom: 1.5rem; background: linear-gradient(to right, #eff6ff, #eef2ff); border: 2px solid #bfdbfe; border-radius: 8px; padding: 1rem;">
  <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; flex-wrap: wrap;">
    <span style="color: #64748b;">üìç Kontext:</span>
    {% if project.organization %}
      <a href="{% url 'organization_detail' project.organization.organization_id %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">
        {{ project.organization.name }}
      </a>
    {% else %}
      <span style="font-weight: 500; color: #1e293b;">Osobn√≠</span>
    {% endif %}
    <span style="color: #9ca3af;">‚Üí</span>
    <a href="{% url 'index_project_cs' %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">
      Projekty
    </a>
    <span style="color: #9ca3af;">‚Üí</span>
    <a href="{% url 'detail_project' project.project_id %}" style="color: #3b82f6; text-decoration: none; font-weight: 500;">
      {{ project.name }}
    </a>
    <span style="color: #9ca3af;">‚Üí</span>
    <span style="font-weight: 600; color: #1e293b;">Nov√Ω √∫kol</span>
  </div>
</div>

<div class="max-w-3xl mx-auto">
  <div class="content-card">
    <form method="post">
      {% csrf_token %}

      <!-- N√°zev -->
      <div class="form-group">
        <label for="id_title" class="form-label">N√°zev √∫kolu <span class="required">*</span></label>
        <input type="text" name="title" id="id_title" required
               value="{{ form.title.value|default_if_none:'' }}"
               placeholder="Nap≈ô. Implementovat login funkcionalitu, Opravit bug v dashboardu"
               class="form-control">
        {% if form.title.errors %}
          <p class="form-error">{{ form.title.errors|join:", " }}</p>
        {% endif %}
      </div>

      <!-- Popis -->
      <div class="form-group">
        <label for="id_description" class="form-label">Popis</label>
        <textarea name="description" id="id_description" rows="6"
                  placeholder="Detailn√≠ popis √∫kolu, co je pot≈ôeba udƒõlat..."
                  class="form-control">{{ form.description.value|default_if_none:'' }}</textarea>
        {% if form.description.errors %}
          <p class="form-error">{{ form.description.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">Popi≈°te co je pot≈ôeba udƒõlat a jak√© jsou oƒçek√°van√© v√Ωsledky. Textov√Ω editor s podporou form√°tov√°n√≠.</div>
      </div>

      <!-- Kategorie -->
      <div class="form-group">
        <label for="id_category" class="form-label">Kategorie <span class="required">*</span></label>
        <select name="category" id="id_category" class="form-control" required>
          <option value="">-- Vyberte kategorii --</option>
          {% for category in form.category.field.queryset %}
            <option value="{{ category.pk }}"
                    {% if form.category.value == category.pk %}selected{% endif %}>
              {{ category.name }}
            </option>
          {% endfor %}
        </select>
        {% if form.category.errors %}
          <p class="form-error">{{ form.category.errors|join:", " }}</p>
        {% endif %}
        <div class="form-help">P≈ôi≈ôaƒète √∫kol do p≈ô√≠slu≈°n√© kategorie pro lep≈°√≠ organizaci</div>
      </div>

      <!-- Priorita a Status vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_priority" class="form-label">Priorita</label>
          <select name="priority" id="id_priority" class="form-control">
            <option value="N√≠zk√°" {% if form.priority.value == "N√≠zk√°" %}selected{% endif %}>N√≠zk√°</option>
            <option value="St≈ôedn√≠" {% if form.priority.value == "St≈ôedn√≠" %}selected{% endif %}>St≈ôedn√≠</option>
            <option value="Vysok√°" {% if form.priority.value == "Vysok√°" %}selected{% endif %}>Vysok√°</option>
            <option value="Nice to have" {% if form.priority.value == "Nice to have" %}selected{% endif %}>Nice to have</option>
          </select>
          <div class="form-help">Urƒçete d≈Øle≈æitost √∫kolu</div>
        </div>

        <div class="form-group">
          <label for="id_status" class="form-label">Status</label>
          <select name="status" id="id_status" class="form-control">
            <option value="Nezah√°jeno" {% if form.status.value == "Nezah√°jeno" %}selected{% endif %}>Nezah√°jeno</option>
            <option value="Prob√≠h√°" {% if form.status.value == "Prob√≠h√°" %}selected{% endif %}>Prob√≠h√°</option>
            <option value="Hotovo" {% if form.status.value == "Hotovo" %}selected{% endif %}>Hotovo</option>
          </select>
          <div class="form-help">Aktu√°ln√≠ stav √∫kolu</div>
        </div>
      </div>

      <!-- Datum dokonƒçen√≠ a P≈ôidƒõleno vedle sebe -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_due_date" class="form-label">Datum dokonƒçen√≠</label>
          <input type="date" name="due_date" id="id_due_date"
                 value="{{ form.due_date.value|default_if_none:'' }}"
                 class="form-control">
          {% if form.due_date.errors %}
            <p class="form-error">{{ form.due_date.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Pl√°novan√Ω term√≠n dokonƒçen√≠ √∫kolu</div>
        </div>

        <div class="form-group">
          <label for="id_assigned" class="form-label">P≈ôidƒõleno</label>
          <select name="assigned" id="id_assigned" class="form-control">
            <option value="">-- Nep≈ôi≈ôazeno --</option>
            {% for member in project.project_users.all %}
              <option value="{{ member.user.id }}"
                      {% if form.assigned.value == member.user.id %}selected{% endif %}>
                {{ member.user.username }}
              </option>
            {% endfor %}
          </select>
          {% if form.assigned.errors %}
            <p class="form-error">{{ form.assigned.errors|join:", " }}</p>
          {% endif %}
          <div class="form-help">Vyberte osobu odpovƒõdnou za √∫kol</div>
        </div>
      </div>

      <!-- Akce -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <a href="{% url 'detail_project' project.project_id %}" class="btn btn-outline">Zru≈°it</a>
        <button type="submit" class="btn btn-primary">‚ûï Vytvo≈ôit √∫kol</button>
      </div>
    </form>
  </div>
</div>

<!-- Inicializace Summernote -->
<script>
  $(document).ready(function() {
    $('#id_description').summernote({
      placeholder: 'Detailn√≠ popis √∫kolu, co je pot≈ôeba udƒõlat...',
      tabsize: 2,
      height: 200,
      toolbar: [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['font', ['fontsize', 'color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']],
        ['insert', ['link']],
        ['view', ['fullscreen', 'codeview']]
      ]
    });
  });
</script>
{% endblock %}
