{% extends 'base.html' %}
{% load i18n %}

{% block title %}Seznam smluv | FDK.cz{% endblock %}
{% block header_title %}üìÑ Seznam smluv{% endblock %}
{% block header_subtitle %}Spr√°va v≈°ech smluv v syst√©mu{% endblock %}

{% block context_breadcrumbs %}
<span class="breadcrumb-link">Osobn√≠</span>
<span class="breadcrumb-sep">‚Üí</span>
<span style="font-weight: 600; color: #1e293b;">Smlouvy</span>
{% endblock %}

{% block content %}

<div style="max-width: 1200px; margin: 0 auto;">

  <!-- Actions -->
  <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
    <div>
      {% if project %}
        <a href="{% url 'create_contract' project.project_id %}" class="btn btn-primary">+ Nov√° smlouva</a>
      {% elif user_projects %}
        <div style="position: relative; display: inline-block;">
          <button id="newContractBtn" class="btn btn-primary" type="button">+ Nov√° smlouva</button>
          <div id="projectDropdown" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 0.5rem; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 250px; z-index: 1000;">
            <div style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; font-weight: 600; color: #1e293b;">Vyberte projekt</div>
            {% for proj in user_projects %}
              <a href="{% url 'create_contract' proj.project_id %}" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; transition: background 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                üìÅ {{ proj.name }}
              </a>
            {% endfor %}
          </div>
        </div>
      {% else %}
        <span style="color: #64748b; font-size: 0.875rem;">Nejprve vytvo≈ôte projekt</span>
      {% endif %}
    </div>
    <div style="display: flex; gap: 0.5rem;">
      <input type="text" placeholder="Hledat smlouvy..." style="padding: 0.5rem 1rem; border: 1px solid #e2e8f0; border-radius: 6px; width: 300px;">
    </div>
  </div>

  <!-- Contracts Table -->
  <div class="content-card">
    {% if contracts %}
    <div style="overflow-x: auto;">
      <table class="data-table">
        <thead>
          <tr>
            <th>N√°zev smlouvy</th>
            <th>Zaƒç√°tek</th>
            <th>Konec</th>
            <th>Status</th>
            <th class="text-right">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for contract in contracts %}
          <tr>
            <td>
              <a href="{% url 'detail_contract' contract.pk %}" style="font-weight: 600; color: #3b82f6; text-decoration: none;">
                {{ contract.name }}
              </a>
            </td>
            <td>{{ contract.start_date|date:"d.m.Y"|default:"‚Äî" }}</td>
            <td>{{ contract.end_date|date:"d.m.Y"|default:"‚Äî" }}</td>
            <td>
              {% if contract.is_active %}
                <span style="background: #d1fae5; color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">‚úì Aktivn√≠</span>
              {% else %}
                <span style="background: #fee2e2; color: #991b1b; padding: 4px 12px; border-radius: 12px; font-size: 0.875rem; font-weight: 500;">‚úó Neaktivn√≠</span>
              {% endif %}
            </td>
            <td class="text-right">
              <a href="{% url 'detail_contract' contract.pk %}" class="btn btn-outline btn-sm">Zobrazit</a>
              <a href="{% url 'edit_contract' contract.pk %}" class="btn btn-outline btn-sm">Upravit</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 3rem; background: #f8fafc; border-radius: 8px;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üìÑ</div>
      <h3 style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">≈Ω√°dn√© smlouvy</h3>
      <p style="color: #64748b; margin-bottom: 1.5rem;">Zat√≠m nem√°te v syst√©mu ≈æ√°dn√© smlouvy.</p>
      {% if project %}
        <a href="{% url 'create_contract' project.project_id %}" class="btn btn-primary">+ Vytvo≈ôit prvn√≠ smlouvu</a>
      {% elif user_projects %}
        <p style="color: #64748b; margin-bottom: 1rem;">Kliknƒõte na tlaƒç√≠tko "Nov√° smlouva" naho≈ôe a vyberte projekt.</p>
      {% else %}
        <p style="color: #64748b; margin-bottom: 1rem;">Nejprve <a href="{% url 'new_project_cs' %}" style="color: #3b82f6;">vytvo≈ôte projekt</a>, pot√© m≈Ø≈æete p≈ôidat smlouvy.</p>
      {% endif %}
    </div>
    {% endif %}
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const newContractBtn = document.getElementById('newContractBtn');
  const projectDropdown = document.getElementById('projectDropdown');

  if (newContractBtn && projectDropdown) {
    newContractBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      projectDropdown.style.display = projectDropdown.style.display === 'none' ? 'block' : 'none';
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!newContractBtn.contains(e.target) && !projectDropdown.contains(e.target)) {
        projectDropdown.style.display = 'none';
      }
    });
  }
});
</script>
{% endblock %}
