{% extends 'user/base.html' %}
{% load i18n %}

{% block title %}Registrace{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 400px;">
    <h2 class="mb-4 text-center" style="font-weight: bold; color: #333;">Registrace</h2>

    {% if user.is_authenticated %}
        <p class="alert alert-success text-center">Přihlášen jako {{ user.username }}</p>
        <p class="alert alert-success text-center"><a href="/odhlaseni/">Odhlásit</a></p>
    {% else %}

        <!-- Zobrazení obecných chyb formuláře -->
        {% if form.errors %}
            <div class="alert alert-danger text-center" style="margin-bottom: 1rem; padding: 0.75rem; border-radius: 6px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;">
                <ul style="list-style-type: none; padding: 0;">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <form method="POST" class="p-4 border rounded shadow-sm" style="background-color: #f0f4f8; border: 1px solid #d1d5db; border-radius: 8px;">
            {% csrf_token %}

            <!-- Uživatelské jméno -->
            <div class="mb-4">
                <label for="id_username" class="form-label" style="font-weight: 600; color: #555;">Uživatelské jméno</label>
                <input type="text" name="username" id="id_username" class="form-control" placeholder="Zadejte uživatelské jméno" value="{{ form.username.value|default_if_none:'' }}" required 
                       style="padding: 10px; border-radius: 6px; border: 1px solid #cbd5e0; background-color: #fff; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); width: 100%;">
                {% if form.username.errors %}
                    <div class="text-danger">
                        {% for error in form.username.errors %}
                            <small>{{ error }}</small><br>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Email -->
            <div class="mb-4">
                <label for="id_email" class="form-label" style="font-weight: 600; color: #555;">Email</label>
                <input type="email" name="email" id="id_email" class="form-control" placeholder="Zadejte email" value="{{ form.email.value|default_if_none:'' }}" required 
                       style="padding: 10px; border-radius: 6px; border: 1px solid #cbd5e0; background-color: #fff; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); width: 100%;">
                {% if form.email.errors %}
                    <div class="text-danger">
                        {% for error in form.email.errors %}
                            <small>{{ error }}</small><br>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Heslo -->
            <div class="mb-4">
                <label for="id_password1" class="form-label" style="font-weight: 600; color: #555;">Heslo</label>


<div class="input-group" style="display: flex; align-items: stretch;">
    <input type="password" name="password1" id="id_password1" class="form-control" placeholder="Zadejte heslo" required 
           style="padding: 10px; border-radius: 6px 0 0 6px; border: 1px solid #cbd5e0; background-color: #fff; width: 100%; height: 40px;">
    <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('id_password1')" 
            style="height: 40px; width: 45px; border-radius: 0 6px 6px 0; border: 1px solid #cbd5e0; border-left: none; background-color: #e2e8f0; display: flex; align-items: center; justify-content: center;">
        <i class="material-icons" id="password-icon1" style="font-size: 20px;">visibility</i>
    </button>
</div>



                <small class="form-text text-muted">
                    Heslo musí mít alespoň 8 znaků a obsahovat číslo. Nesmí obsahovat jednoduché sekvence jako "123456".
                </small>
                {% if form.password1.errors %}
                    <div class="text-danger">
                        {% for error in form.password1.errors %}
                            <small>{{ error }}</small><br>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Potvrzení hesla -->
            <div class="mb-4">
                <label for="id_password2" class="form-label" style="font-weight: 600; color: #555;">Potvrzení hesla</label>


<div class="input-group" style="display: flex; align-items: stretch;">
    <input type="password" name="password2" id="id_password2" class="form-control" placeholder="Zadejte heslo" required 
           style="padding: 10px; border-radius: 6px 0 0 6px; border: 1px solid #cbd5e0; background-color: #fff; width: 100%; height: 40px;">
    <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('id_password2')" 
            style="height: 40px; width: 45px; border-radius: 0 6px 6px 0; border: 1px solid #cbd5e0; border-left: none; background-color: #e2e8f0; display: flex; align-items: center; justify-content: center;">
        <i class="material-icons" id="password-icon1" style="font-size: 20px;">visibility</i>
    </button>
</div>

                {% if form.password2.errors %}
                    <div class="text-danger">
                        {% for error in form.password2.errors %}
                            <small>{{ error }}</small><br>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-3" style="padding: 10px; font-weight: bold; background-color: #4a90e2; border: none; border-radius: 6px;">Registrovat se</button>
        </form>
        
        <p class="mt-4 text-center" style="color: #555;">Již máte účet? <a href="{% url 'login_cs' %}" style="color: #4a90e2; font-weight: bold; text-decoration: none;">Přihlaste se zde</a></p>
    {% endif %}
</div>

<script>
    function togglePassword(fieldId) {
        var passwordField = document.getElementById(fieldId);
        var icon = document.getElementById("password-icon" + (fieldId === 'id_password1' ? '1' : '2'));
        if (passwordField.type === "password") {
            passwordField.type = "text";
            icon.textContent = "visibility_off";
        } else {
            passwordField.type = "password";
            icon.textContent = "visibility";
        }
    }
</script>
{% endblock %}
