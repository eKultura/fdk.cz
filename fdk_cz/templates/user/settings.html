{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "NastavenÃ­ profilu" %} | FDK.cz{% endblock %}
{% block header_title %}âš™ï¸ {% trans "NastavenÃ­ profilu" %}{% endblock %}
{% block header_subtitle %}Upravte svÃ© osobnÃ­ Ãºdaje a spravujte moduly{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">

  <!-- Profile Form -->
  <div class="content-card">
    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: #1e293b;">ğŸ‘¤ {% trans "OsobnÃ­ Ãºdaje" %}</h3>

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <div style="display: grid; gap: 1.5rem;">
        <!-- First Name -->
        <div>
          <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">{% trans "JmÃ©no" %}</label>
          <input
            type="text"
            name="first_name"
            value="{{ form.first_name.value|default:user.first_name }}"
            class="form-control"
            style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px;"
            placeholder="{% trans 'Zadejte jmÃ©no' %}"
          >
        </div>

        <!-- Last Name -->
        <div>
          <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">{% trans "PÅ™Ã­jmenÃ­" %}</label>
          <input
            type="text"
            name="last_name"
            value="{{ form.last_name.value|default:user.last_name }}"
            class="form-control"
            style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px;"
            placeholder="{% trans 'Zadejte pÅ™Ã­jmenÃ­' %}"
          >
        </div>

        <!-- Email -->
        <div>
          <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">{% trans "Email" %}</label>
          <input
            type="email"
            name="email"
            value="{{ form.email.value|default:user.email }}"
            class="form-control"
            style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px;"
            placeholder="{% trans 'Zadejte email' %}"
          >
        </div>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
        <button type="submit" class="btn btn-primary">âœ“ {% trans "UloÅ¾it zmÄ›ny" %}</button>
        <a href="{% url 'user_profile' %}" class="btn btn-outline">â† ZpÄ›t na profil</a>
      </div>
    </form>
  </div>

  <!-- Module Management Section -->
  <div id="moduly" class="content-card" style="margin-top: 2rem;">
    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1e293b;">ğŸ”§ SprÃ¡va modulÅ¯ v menu</h3>
    <p style="color: #64748b; margin-bottom: 1.5rem;">ZapnÄ›te nebo vypnÄ›te moduly, kterÃ© chcete vidÄ›t v navigaÄnÃ­m menu pro lepÅ¡Ã­ pÅ™ehlednost.</p>

    <div style="display: grid; gap: 0.75rem;">
      {% for item in modules_with_prefs %}
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">
        <div style="display: flex; align-items: center; gap: 0.75rem; flex: 1;">
          <span style="font-size: 2rem;">{{ item.module.icon|default:"ğŸ“¦" }}</span>
          <div>
            <div style="font-weight: 600; color: #1e293b;">{{ item.module.display_name }}</div>
            <div style="font-size: 0.875rem; color: #64748b;">{{ item.module.short_description|default:item.module.description|truncatewords:10 }}</div>
            {% if item.module.is_free %}
              <span style="display: inline-block; font-size: 0.75rem; background: #d1fae5; color: #065f46; padding: 2px 8px; border-radius: 12px; margin-top: 0.25rem;">Zdarma</span>
            {% endif %}
          </div>
        </div>

        <form method="POST" action="{% url 'toggle_module_visibility' item.module.module_id %}" style="margin: 0;">
          {% csrf_token %}
          <button type="submit" style="position: relative; display: inline-flex; height: 24px; width: 44px; align-items: center; border-radius: 12px; transition: background-color 0.2s; border: none; cursor: pointer; {% if item.is_visible %}background: #3b82f6;{% else %}background: #cbd5e1;{% endif %}">
            <span style="display: inline-block; height: 16px; width: 16px; border-radius: 50%; background: white; transition: transform 0.2s; {% if item.is_visible %}transform: translateX(22px);{% else %}transform: translateX(4px);{% endif %}"></span>
          </button>
        </form>
      </div>
      {% empty %}
      <div style="text-align: center; padding: 2rem; background: #f8fafc; border-radius: 8px;">
        <p style="color: #64748b;">Å½Ã¡dnÃ© moduly k dispozici.</p>
      </div>
      {% endfor %}
    </div>

    <div style="margin-top: 1.5rem; padding: 1rem; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 8px;">
      <p style="font-size: 0.875rem; color: #1e40af;">
        <strong>ğŸ’¡ Tip:</strong> VypnutÃ© moduly zÅ¯stÃ¡vajÃ­ dostupnÃ© pÅ™es vyhledÃ¡vÃ¡nÃ­, jen se nebudou zobrazovat v navigaÄnÃ­m menu.
      </p>
    </div>
  </div>

</div>
{% endblock %}
