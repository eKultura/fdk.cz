{% extends "base.html" %}
{% load i18n %}

{% block title %}Profil | FDK.cz{% endblock %}
{% block header_title %}ğŸ‘¤ MÅ¯j profil{% endblock %}
{% block header_subtitle %}{{ user.first_name }} {{ user.last_name }} Â· {{ user.email }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">

  <!-- Profile Header Card -->
  <div class="content-card" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 4px solid #3b82f6;">
    <div class="flex flex-col md:flex-row items-center gap-6">
      <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #1d4ed8); display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5rem; font-weight: 700; border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex-shrink: 0;">
        {% if user.profile.photo %}
          <img src="{{ user.profile.photo.url }}" alt="Foto" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
        {% else %}
          {{ user.first_name|first|default:user.username|first|upper }}
        {% endif %}
      </div>

      <div class="flex-1 text-center md:text-left">
        <h2 class="text-2xl md:text-3xl font-bold mb-2 text-gray-900">
          {{ user.first_name }} {{ user.last_name }}
        </h2>
        <p class="text-gray-600 mb-4">
          @{{ user.username }} Â· {{ user.email }}
        </p>

        <div class="flex flex-col sm:flex-row gap-3 justify-center md:justify-start">
          <a href="{% url 'user_settings' %}" class="btn btn-primary">âš™ï¸ Upravit profil</a>
          <a href="{% url 'logout_cs' %}" class="btn btn-outline">ğŸšª OdhlÃ¡sit se</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Information Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">

    <!-- Personal Information -->
    <div class="content-card">
      <h3 class="text-xl font-semibold mb-4 text-gray-900">
        ğŸ“‹ OsobnÃ­ informace
      </h3>

      <div class="data-table-simple">
        <div class="data-row">
          <span class="data-label">UÅ¾ivatelskÃ© jmÃ©no</span>
          <span class="data-value">{{ user.username }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">JmÃ©no</span>
          <span class="data-value">{{ user.first_name|default:"Nenastaveno" }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">PÅ™Ã­jmenÃ­</span>
          <span class="data-value">{{ user.last_name|default:"Nenastaveno" }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">Email</span>
          <span class="data-value break-words">{{ user.email|default:"NenÃ­ nastaven" }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">Telefon</span>
          <span class="data-value">{{ user.profile.phone_number|default:"Nenastaveno" }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">Lokalita</span>
          <span class="data-value">{{ user.profile.location|default:"Nenastaveno" }}</span>
        </div>
      </div>
    </div>

    <!-- Account Stats -->
    <div class="content-card">
      <h3 class="text-xl font-semibold mb-4 text-gray-900">
        ğŸ“Š Statistiky ÃºÄtu
      </h3>

      <div class="grid grid-cols-2 gap-4">
        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-blue-600">{{ user.owned_projects.count }}</div>
          <div class="text-sm text-gray-600 mt-1">VlastnÄ›nÃ© projekty</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-green-600">{{ user.project_memberships.count }}</div>
          <div class="text-sm text-gray-600 mt-1">ÄŒlenstvÃ­ v projektech</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-amber-600">{{ user.assigned_tasks.count }}</div>
          <div class="text-sm text-gray-600 mt-1">PÅ™iÅ™azenÃ© Ãºkoly</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-purple-600">{{ user.created_organizations.count }}</div>
          <div class="text-sm text-gray-600 mt-1">Organizace</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Extended Statistics -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">

    <!-- Task Statistics -->
    <div class="content-card">
      <h3 class="text-xl font-semibold mb-4 text-gray-900">
        âœ… Statistiky ÃºkolÅ¯
      </h3>

      <div class="grid grid-cols-3 gap-3">
        <div class="bg-blue-50 border-2 border-blue-600 rounded-lg p-4 text-center">
          <div class="text-2xl md:text-3xl font-bold text-blue-700">{{ tasks_created }}</div>
          <div class="text-xs text-gray-600 font-semibold mt-1">VytvoÅ™il</div>
        </div>

        <div class="bg-amber-50 border-2 border-amber-500 rounded-lg p-4 text-center">
          <div class="text-2xl md:text-3xl font-bold text-amber-700">{{ tasks_in_progress }}</div>
          <div class="text-xs text-gray-600 font-semibold mt-1">ProbÃ­hÃ¡</div>
        </div>

        <div class="bg-green-50 border-2 border-green-500 rounded-lg p-4 text-center">
          <div class="text-2xl md:text-3xl font-bold text-green-700">{{ tasks_completed }}</div>
          <div class="text-xs text-gray-600 font-semibold mt-1">DokonÄil</div>
        </div>
      </div>
    </div>

    <!-- Error Statistics -->
    <div class="content-card">
      <h3 class="text-xl font-semibold mb-4 text-gray-900">
        ğŸ› Statistiky chyb z testovÃ¡nÃ­
      </h3>

      <div class="grid grid-cols-2 gap-4">
        <div class="bg-red-50 border-2 border-red-500 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-red-700">{{ errors_created }}</div>
          <div class="text-sm text-gray-600 font-semibold mt-1">Celkem nalezenÃ½ch chyb</div>
        </div>

        <div class="bg-orange-50 border-2 border-orange-500 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-orange-700">{{ errors_open }}</div>
          <div class="text-sm text-gray-600 font-semibold mt-1">OtevÅ™enÃ© chyby</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Active Modules -->
  <div class="content-card mt-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-semibold text-gray-900">
        ğŸ”§ AktivnÃ­ moduly
      </h3>
      <a href="{% url 'user_settings' %}" class="btn btn-outline btn-sm">Spravovat moduly</a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for module in user.visible_modules.all %}
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center gap-3">
          <span class="text-2xl flex-shrink-0">{{ module.icon|default:"ğŸ“¦" }}</span>
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-gray-900 truncate">{{ module.display_name }}</div>
            <div class="text-xs text-gray-600 truncate">{{ module.description|truncatewords:5 }}</div>
          </div>
        </div>
      {% empty %}
        <div class="col-span-full text-center py-8 text-gray-600">
          NemÃ¡te Å¾Ã¡dnÃ© aktivnÃ­ moduly
        </div>
      {% endfor %}
    </div>
  </div>

</div>

<style>
  .data-table-simple {
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
  }

  .data-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f1f5f9;
    gap: 1rem;
  }

  .data-row:last-child {
    border-bottom: none;
  }

  .data-row:hover {
    background: #f8fafc;
  }

  .data-label {
    font-weight: 600;
    color: #475569;
    flex-shrink: 0;
  }

  .data-value {
    color: #1e293b;
    text-align: right;
    word-break: break-word;
  }
</style>
{% endblock %}
