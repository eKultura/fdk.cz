{% extends "base.html" %}
{% block title %}SprÃ¡va rizik | FDK.cz{% endblock %}
{% block header_title %}âš ï¸ SprÃ¡va rizik{% endblock %}
{% block header_subtitle %}Identifikace, hodnocenÃ­ a Å™Ã­zenÃ­ rizik projektÅ¯{% endblock %}

{% block context_breadcrumbs %}
<span class="breadcrumb-link">Organizace</span>
<span class="breadcrumb-sep">â†’</span>
<span style="font-weight: 600; color: #1e293b;">Rizika</span>
{% endblock %}

{% block content %}

<div class="">
  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <a href="{% url 'risk_dashboard' %}" class="tab-button active">ğŸ“Š Dashboard</a>
    <a href="{% url 'list_risks' %}" class="tab-button">ğŸ“‹ VÅ¡echna rizika</a>
    <a href="{% url 'risk_matrix' %}" class="tab-button">ğŸ¯ RizikovÃ¡ matice</a>
  </div>

  <!-- Actions -->
  <div class="content-card" style="margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2 style="font-size: 1.125rem; font-weight: 600; margin: 0;">SprÃ¡va rizik</h2>
      <a href="{% url 'create_risk' %}" class="btn btn-primary">ï¼‹ NovÃ© riziko</a>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-grid mb-6">
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">Celkem rizik</div>
          <div class="stat-value">{{ total_risks|default:0 }}</div>
        </div>
        <div class="stat-icon primary">ğŸ“Š</div>
      </div>
    </div>
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">KritickÃ¡ rizika</div>
          <div class="stat-value">{{ critical_risks|default:0 }}</div>
        </div>
        <div class="stat-icon warning">ğŸ”´</div>
      </div>
    </div>
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">PrÅ¯mÄ›rnÃ© skÃ³re</div>
          <div class="stat-value">{{ avg_risk_score|default:0|floatformat:1 }}</div>
        </div>
        <div class="stat-icon info">ğŸ“ˆ</div>
      </div>
    </div>
    <div class="stat-card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <div class="stat-title">AktivnÃ­</div>
          <div class="stat-value">{{ risks_by_status.identified|default:0 }}</div>
        </div>
        <div class="stat-icon success">âœ…</div>
      </div>
    </div>
  </div>

  <!-- Recent Risks -->
  <div class="content-card">
    <h3 class="text-xl font-semibold mb-4">âš ï¸ NedÃ¡vnÃ¡ rizika (seÅ™azeno podle skÃ³re)</h3>
    {% if risks %}
    <div class="overflow-x-auto">
    <table class="data-table">
      <thead>
        <tr>
          <th>NÃ¡zev</th>
          <th class="hidden md:table-cell">Projekt/Organizace</th>
          <th>SkÃ³re</th>
          <th class="hidden md:table-cell">PravdÄ›podobnost</th>
          <th class="hidden md:table-cell">Dopad</th>
          <th>Status</th>
          <th class="text-right">Akce</th>
        </tr>
      </thead>
      <tbody>
        {% for risk in risks %}
        <tr>
          <td>
            <a href="{% url 'detail_risk' risk.risk_id %}"><strong>{{ risk.name }}</strong></a>
          </td>
          <td class="hidden md:table-cell">
            {% if risk.project %}
              <a href="{% url 'detail_project' risk.project.project_id %}" class="text-blue-600 hover:underline">
                {{ risk.project.name }}
              </a>
            {% elif risk.organization %}
              {{ risk.organization.name }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            <span class="px-2 py-1 rounded text-xs font-bold
              {% if risk.risk_score >= 15 %}bg-red-100 text-red-700
              {% elif risk.risk_score >= 10 %}bg-orange-100 text-orange-700
              {% elif risk.risk_score >= 5 %}bg-yellow-100 text-yellow-700
              {% else %}bg-green-100 text-green-700{% endif %}">
              {{ risk.risk_score }}
            </span>
          </td>
          <td class="hidden md:table-cell">{{ risk.probability }}/5</td>
          <td class="hidden md:table-cell">{{ risk.impact }}/5</td>
          <td>
            <span class="px-2 py-1 rounded text-xs font-medium
              {% if risk.status == 'mitigated' %}bg-green-100 text-green-700
              {% elif risk.status == 'identified' %}bg-blue-100 text-blue-700
              {% elif risk.status == 'occurred' %}bg-red-100 text-red-700
              {% else %}bg-gray-100 text-gray-700{% endif %}">
              {{ risk.get_status_display }}
            </span>
          </td>
          <td class="text-right">
            <div class="data-table-actions">
              <a href="{% url 'detail_risk' risk.risk_id %}">ğŸ‘ï¸ Detail</a>
              <a href="{% url 'edit_risk' risk.risk_id %}">âœï¸ Upravit</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
    {% else %}
    <div class="text-center py-8 bg-gray-50 rounded-lg">
      <p class="text-gray-500">ZatÃ­m nejsou Å¾Ã¡dnÃ¡ identifikovanÃ¡ rizika. <a href="{% url 'create_risk' %}" class="text-blue-600 hover:underline">VytvoÅ™it prvnÃ­ riziko</a></p>
    </div>
    {% endif %}
  </div>

  <!-- Risk Legend -->
  <div class="content-card mt-6">
    <h3 class="text-lg font-semibold mb-3">ğŸ“Œ Legenda skÃ³re rizik</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <div class="bg-green-50 border-2 border-green-200 rounded-lg p-3">
        <div class="font-semibold text-green-700">NÃ­zkÃ© (1-4)</div>
        <p class="text-xs text-gray-600">PÅ™ijatelnÃ© riziko</p>
      </div>
      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-3">
        <div class="font-semibold text-yellow-700">StÅ™ednÃ­ (5-9)</div>
        <p class="text-xs text-gray-600">Sledovat</p>
      </div>
      <div class="bg-orange-50 border-2 border-orange-200 rounded-lg p-3">
        <div class="font-semibold text-orange-700">VysokÃ© (10-14)</div>
        <p class="text-xs text-gray-600">Mitigovat</p>
      </div>
      <div class="bg-red-50 border-2 border-red-200 rounded-lg p-3">
        <div class="font-semibold text-red-700">KritickÃ© (15+)</div>
        <p class="text-xs text-gray-600">Priorita!</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
