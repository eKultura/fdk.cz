{% extends "base.html" %}
{% block title %}Nov√© riziko | FDK.cz{% endblock %}
{% block header_title %}‚ö†Ô∏è Vytvo≈ôit nov√© riziko{% endblock %}
{% block header_subtitle %}Identifikace a hodnocen√≠ rizika{% endblock %}

{% block context_breadcrumbs %}
<a href="{% url 'risk_dashboard' %}" class="breadcrumb-link">Rizika</a>
<span class="breadcrumb-sep">‚Üí</span>
<span style="font-weight: 600; color: #1e293b;">Nov√©</span>
{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto">
  <div class="content-card">
    <form method="POST">
      {% csrf_token %}

      <!-- Basic Info Section -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">üìã Z√°kladn√≠ informace</h3>

        <div class="form-group">
          <label for="id_title" class="form-label">N√°zev rizika <span class="required">*</span></label>
          {{ form.title }}
          {% if form.title.errors %}
            <div class="text-red-600 text-sm mt-1">{{ form.title.errors }}</div>
          {% endif %}
          <div class="form-help">Struƒçn√Ω a v√Ωsti≈æn√Ω n√°zev identifikovan√©ho rizika</div>
        </div>

        <div class="form-group">
          <label for="id_description" class="form-label">Popis rizika <span class="required">*</span></label>
          {{ form.description }}
          {% if form.description.errors %}
            <div class="text-red-600 text-sm mt-1">{{ form.description.errors }}</div>
          {% endif %}
          <div class="form-help">Detailn√≠ popis rizika, jeho p≈ô√≠ƒçin a mo≈æn√Ωch d≈Øsledk≈Ø</div>
        </div>
      </div>

      <!-- Context Section -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">üîó Kontext</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="id_project" class="form-label">Projekt</label>
            {{ form.project }}
            <div class="form-help">P≈ôi≈ôaƒète riziko k projektu (voliteln√©)</div>
          </div>

          <div class="form-group">
            <label for="id_organization" class="form-label">Organizace</label>
            {{ form.organization }}
            <div class="form-help">Nebo k organizaci (voliteln√©)</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_category" class="form-label">Kategorie <span class="required">*</span></label>
            {{ form.category }}
            {% if form.category.errors %}
              <div class="text-red-600 text-sm mt-1">{{ form.category.errors }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="id_status" class="form-label">Status</label>
            {{ form.status }}
          </div>
        </div>
      </div>

      <!-- Risk Assessment Section -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">üìä Hodnocen√≠ rizika</h3>

        <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
          <div class="flex items-start">
            <div class="text-2xl mr-3">‚ÑπÔ∏è</div>
            <div class="text-sm text-blue-800">
              <strong>Sk√≥re rizika</strong> se poƒç√≠t√° automaticky jako <strong>Pravdƒõpodobnost √ó Dopad</strong>.
              V√Ωsledn√© sk√≥re: 1-6 (n√≠zk√©), 7-12 (st≈ôedn√≠), 13-19 (vysok√©), 20-25 (kritick√©)
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_probability" class="form-label">Pravdƒõpodobnost <span class="required">*</span></label>
            {{ form.probability }}
            {% if form.probability.errors %}
              <div class="text-red-600 text-sm mt-1">{{ form.probability.errors }}</div>
            {% endif %}
            <div class="form-help">
              1 = Velmi n√≠zk√° (1-10%)<br>
              2 = N√≠zk√° (11-30%)<br>
              3 = St≈ôedn√≠ (31-50%)<br>
              4 = Vysok√° (51-75%)<br>
              5 = Velmi vysok√° (76-100%)
            </div>
          </div>

          <div class="form-group">
            <label for="id_impact" class="form-label">Dopad <span class="required">*</span></label>
            {{ form.impact }}
            {% if form.impact.errors %}
              <div class="text-red-600 text-sm mt-1">{{ form.impact.errors }}</div>
            {% endif %}
            <div class="form-help">
              1 = Zanedbateln√Ω<br>
              2 = Mal√Ω<br>
              3 = St≈ôedn√≠<br>
              4 = Velk√Ω<br>
              5 = Kritick√Ω
            </div>
          </div>
        </div>
      </div>

      <!-- Mitigation Section -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">üõ°Ô∏è Opat≈ôen√≠ a pl√°ny</h3>

        <div class="form-group">
          <label for="id_mitigation_strategy" class="form-label">Strategie zm√≠rnƒõn√≠</label>
          {{ form.mitigation_strategy }}
          <div class="form-help">Jak lze toto riziko zm√≠rnit nebo p≈ôedej√≠t mu?</div>
        </div>

        <div class="form-group">
          <label for="id_contingency_plan" class="form-label">Z√°lo≈æn√≠ pl√°n</label>
          {{ form.contingency_plan }}
          <div class="form-help">Co udƒõl√°me, kdy≈æ se riziko realizuje?</div>
        </div>

        <div class="form-group">
          <label for="id_owner" class="form-label">Zodpovƒõdn√° osoba</label>
          {{ form.owner }}
          <div class="form-help">Osoba odpovƒõdn√° za sledov√°n√≠ a ≈ô√≠zen√≠ tohoto rizika</div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <a href="{% url 'list_risks' %}" class="btn btn-outline">Zru≈°it</a>
        <button type="submit" class="btn btn-primary">üíæ Vytvo≈ôit riziko</button>
      </div>
    </form>
  </div>
</div>

<script>
// Auto-calculate risk score
document.addEventListener('DOMContentLoaded', () => {
  const probabilitySelect = document.getElementById('id_probability');
  const impactSelect = document.getElementById('id_impact');

  if (probabilitySelect && impactSelect) {
    const updateRiskScore = () => {
      const prob = parseInt(probabilitySelect.value) || 0;
      const imp = parseInt(impactSelect.value) || 0;
      const score = prob * imp;

      // You could display the score here if needed
      console.log('Risk Score:', score);
    };

    probabilitySelect.addEventListener('change', updateRiskScore);
    impactSelect.addEventListener('change', updateRiskScore);
  }
});
</script>
{% endblock %}
